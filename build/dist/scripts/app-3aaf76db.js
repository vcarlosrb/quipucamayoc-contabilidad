/**
 * generator-cg-gas - Yeoman Generator for Enterprise Angular projects, with Gulp Angular Sass
 * @version v3.3.4
 * @link https://github.com/Lunatic83/generator-cg-gas
 * @license 
 */
angular.module("Accounting",["ui.bootstrap","ui.utils","ui.router","ngStorage","ngAnimate","ngMaterial"]),angular.module("Accounting").config(["$stateProvider","$urlRouterProvider","$locationProvider","$mdDateLocaleProvider",function($stateProvider,$urlRouterProvider,$locationProvider,$mdDateLocaleProvider){$stateProvider.state("app",{url:"/","abstract":!0}),$stateProvider.state("app.login",{url:"login",parent:"app",views:{"@":{templateUrl:"partial/public/login//login.html"}}}),$stateProvider.state("app.error",{url:"error",parent:"app",views:{"@":{templateUrl:"partial/public/error//error.html"}}}),$stateProvider.state("app.private",{url:"",parent:"app","abstract":!0,resolve:{Session:["$timeout","Session","$state",function($timeout,Session,$state){void 0==Session.status()&&$timeout(function(){$state.go("app.login")})}]},views:{"@":{templateUrl:"partial/authState/private//private.html"}}}),$stateProvider.state("app.private.init",{url:"","abstract":!0,parent:"app.private",views:{header:{templateUrl:"partial/base/header//header.html"},panel:{templateUrl:"partial/base/panel//panel.html"},structure:{templateUrl:"partial/authState/structure//structure.html"}}}),$stateProvider.state("app.private.init.home",{url:"",parent:"app.private.init",views:{content:{templateUrl:"partial/base/home//home.html"}}}),$stateProvider.state("app.private.init.stockbroker",{url:"bolsista",parent:"app.private.init",views:{content:{templateUrl:"partial/maintenance/stockbroker//stockbroker.html"}}}),$stateProvider.state("app.private.init.provider",{url:"proveedor",parent:"app.private.init",views:{content:{templateUrl:"partial/maintenance/provider//provider.html"}}}),$stateProvider.state("app.private.init.createProvider",{url:"crear/proveedor",parent:"app.private.init",views:{content:{templateUrl:"partial/maintenance/createProvider//createProvider.html"}}}),$stateProvider.state("app.private.init.detailProvider",{url:"proveedor/:ruc",parent:"app.private.init",views:{content:{templateUrl:"partial/maintenance/detailProvider//detailProvider.html"}}}),$stateProvider.state("app.private.init.createExternal",{url:"crear/servicio_tercero",parent:"app.private.init",views:{content:{templateUrl:"partial/maintenance/createExternal//createExternal.html"}}}),$stateProvider.state("app.private.init.detailExternal",{url:"servicio_tercero/:ruc",parent:"app.private.init",views:{content:{templateUrl:"partial/maintenance/detailExternal//detailExternal.html"}}}),$stateProvider.state("app.private.init.openingCash",{url:"proceso/apertura_caja_chica",parent:"app.private.init",views:{content:{templateUrl:"partial/process/manage/openingCash//openingCash.html"}}}),$stateProvider.state("app.private.init.openingCashCreate",{url:"proceso/apertura_caja_chica/create/:id",parent:"app.private.init",views:{content:{templateUrl:"partial/process/manage/openingCashCreate//openingCashCreate.html"}}}),$stateProvider.state("app.private.init.openingCashDetail",{url:"proceso/apertura_caja_chica/:id",parent:"app.private.init",views:{content:{templateUrl:"partial/process/manage/openingCashDetail//openingCashDetail.html"}}}),$stateProvider.state("app.private.init.settlementCash",{url:"proceso/liquidacion_caja_chica",parent:"app.private.init",views:{content:{templateUrl:"partial/process/manage/settlementCash//settlementCash.html"}}}),$stateProvider.state("app.private.init.refund",{url:"proceso/reembolso",parent:"app.private.init","abstract":!0,views:{content:{templateUrl:"partial/process/register/refund//refund.html"}}}),$stateProvider.state("app.private.init.refund.init",{url:"",parent:"app.private.init.refund"}),$stateProvider.state("app.private.init.refund.structure",{url:"/:refund",parent:"app.private.init.refund","abstract":!0,views:{refund:{templateUrl:"partial/process/register/structureSpending//structureSpending.html"}}}),$stateProvider.state("app.private.init.refund.structure.expenses",{url:"",parent:"app.private.init.refund.structure",views:{spending:{templateUrl:"partial/process/register/expenses//expenses.html"}}}),$stateProvider.state("app.private.init.refund.structure.createSpending",{url:"/crear_gasto",parent:"app.private.init.refund.structure",views:{spending:{templateUrl:"partial/process/register/createSpending//createSpending.html"}}}),$stateProvider.state("app.private.init.refund.structure.detailSpending",{url:"/gasto/:spending",parent:"app.private.init.refund.structure",views:{spending:{templateUrl:"partial/process/register/detailSpending//detailSpending.html"}}}),$stateProvider.state("app.private.init.refund.structure.accountingSpending",{url:"/registro_contable",parent:"app.private.init.refund.structure",views:{spending:{templateUrl:"partial/process/register/accountingSpending//accountingSpending.html"}}}),$stateProvider.state("app.private.init.refundValidate",{url:"proceso/validar/reembolso",parent:"app.private.init","abstract":!0,views:{content:{templateUrl:"partial/process/validate/refundValidate//refundValidate.html"}}}),$stateProvider.state("app.private.init.refundValidate.init",{url:"",parent:"app.private.init.refundValidate"}),$stateProvider.state("app.private.init.refundValidate.structure",{url:"/:refund",parent:"app.private.init.refundValidate","abstract":!0,views:{refund:{templateUrl:"partial/process/validate/structureSpendingValidate//structureSpendingValidate.html"}}}),$stateProvider.state("app.private.init.refundValidate.structure.expenses",{url:"",parent:"app.private.init.refundValidate.structure",views:{spending:{templateUrl:"partial/process/validate/expensesValidate//expensesValidate.html"}}}),$stateProvider.state("app.private.init.refundValidate.structure.detailSpending",{url:"/gasto/:spending",parent:"app.private.init.refundValidate.structure",views:{spending:{templateUrl:"partial/process/validate/detailSpendingValidate//detailSpendingValidate.html"}}}),$mdDateLocaleProvider.months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],$mdDateLocaleProvider.shortMonths=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],$mdDateLocaleProvider.days=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],$mdDateLocaleProvider.shortDays=["Do","Lu","Ma","Mi","Ju","Vi","Sá"],$mdDateLocaleProvider.msgCalendar="Calendario",$mdDateLocaleProvider.msgOpenCalendar="Abrir calendario",$mdDateLocaleProvider.formatDate=function(date){return moment(date).format("DD-MM-YYYY")},$urlRouterProvider.otherwise("/")}]),angular.module("Accounting").run(["$rootScope","Path","PathSession","PathSunat",function($rootScope,Path,PathSession,PathSunat){$rootScope.safeApply=function(fn){var phase=$rootScope.$$phase;"$apply"===phase||"$digest"===phase?fn&&"function"==typeof fn&&fn():this.$apply(fn)},$rootScope.Path=Path,$rootScope.PathSession=PathSession,$rootScope.PathSunat=PathSunat}]).constant("Path","http://quipucamayoc.unmsm.edu.pe/ContabilidadWeb/api/").constant("PathSession","http://quipucamayoc.unmsm.edu.pe/SistemaControlAcceso/api/").constant("PathSunat","http://quipucamayoc.unmsm.edu.pe/sunat-web/api/"),angular.module("Accounting").controller("MainCtrl",["$scope","User","Session","$localStorage",function($scope,User,Session,$localStorage){}]),angular.module("Accounting").controller("LoginCtrl",["$scope","$state","User","Session",function($scope,$state,User,Session){$scope.Form={},$scope.Valid={username:!1,password:!1},$scope.Events={goLogin:function(){$state.go("app.private.init.home")}},$scope.Services={loader:!1,login:function(form){var self=this;if($scope.Validate.login(form)&&0==self.loader){self.loader=!0;var data={ip:window.IP,aplicacion:"101",usuario:form.username,password:form.password};User.login(data).then(function(response){if(response.headers("token")){var session={token:response.headers("token"),email:response.data.correo,app:"101",idProfile:response.data.idPerfil,ip:window.IP,idDependence:response.data.idDependencia,dniUser:response.data.dniUsuario,codDependence:response.data.codigoDependencia,descDependence:response.data.descripcionDependencia};Session.set(session),User.setUser(response.data),$state.go("app.private.init.home")}else self.loader=!1,swal("¡Error!",response.data.mensaje,"error")},function(err){self.loader=!1,swal("¡Error!",err.data.mensaje,"error")})}}},$scope.Validate={login:function(data){return $scope.Valid.username=void 0==data.username||""==data.username,$scope.Valid.password=void 0==data.password||""==data.password,!$scope.Valid.username&&!$scope.Valid.password}}}]),angular.module("Accounting").controller("ErrorCtrl",["$scope",function($scope){}]),angular.module("Accounting").controller("PrivateCtrl",["$scope","DateService",function($scope,DateService){var date=new Date;DateService.getDateStorage()?$scope.DateGlobal={month:DateService.getMonth(DateService.getDateStorage().month),year:DateService.getDateStorage().year}:$scope.DateGlobal={month:DateService.getMonth(date.getMonth()+1),year:date.getFullYear()},$scope.UtilsGlobal={setDate:function(form){form.month=DateService.getMonth(form.month),$scope.DateGlobal=form}}}]),angular.module("Accounting").factory("Request",["$q","$rootScope","$http","Session",function($q,$rootScope,$http,Session){return{Post:function(data,url,headers){var deferred=$q.defer();return $http.post(url,data,{headers:headers}).then(function(res){Session.restartTime(),deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},Get:function(url,headers){var deferred=$q.defer();return $http.get(url,{headers:headers}).then(function(res){Session.restartTime(),deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},Put:function(data,url,headers){var deferred=$q.defer();return $http.put(url,data,{headers:headers}).then(function(res){Session.restartTime(),deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},Patch:function(data,url){var deferred=$q.defer();return $http.patch(url,data).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},Delete:function(url,headers){var deferred=$q.defer();return $http["delete"](url,{headers:headers}).then(function(res){Session.restartTime(),deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").factory("User",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){var UserData=null;return{login:function(data){var deferred=$q.defer(),url=$rootScope.PathSession+"public/login/usuarioPrivado";return Request.Post({},url,data).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},logout:function(data){var deferred=$q.defer(),url=$rootScope.PathSession+"public/logout";return Request.Post({},url,data).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},setUser:function(data){UserData=data}}}]),angular.module("Accounting").controller("HeaderCtrl",["$scope","$state","User","Session","$localStorage","$rootScope",function($scope,$state,User,Session,$localStorage,$rootScope){function getTimeRemaining(endtime){var t=Date.parse(endtime)-Date.parse(new Date),seconds=Math.floor(t/1e3%60),minutes=Math.floor(t/1e3/60%60),hours=Math.floor(t/36e5%24),days=Math.floor(t/864e5);return{total:t,days:days,hours:hours,minutes:minutes,seconds:seconds}}function initializeClock(id,endtime){function updateClock(){var t=getTimeRemaining(endtime);minutesSpan.html(("0"+t.minutes).slice(-2)),secondsSpan.html(("0"+t.seconds).slice(-2)),t.total<=0&&(clearInterval(timeinterval),$scope.Services.logout())}var minutesSpan=$(".minutes"),secondsSpan=$(".seconds");updateClock(),timeinterval=setInterval(updateClock,1e3)}$scope.UserSession={};var timeinterval=null;$scope.CountDown={init:function(){var deadline=new Date(Date.parse(new Date)+12e5);initializeClock("clockdiv",deadline)}},$scope.CountDown.init(),$scope.Services={log:!0,constructor:function(){this.getData()},getData:function(){$scope.UserSession=Session.get()},logout:function(){if(1==this.log){this.log=!1;var data={aplicacion:"101",usuario:Session.get().email,token:Session.get().token};User.logout(data).then(function(response){$localStorage.$reset(),$state.go("app.login")},function(err){swal("¡Error!",err.data.mensaje,"error")})}}},$scope.Services.constructor(),$rootScope.$on("restartCountdown",function(){clearInterval(timeinterval),$scope.CountDown.init()})}]),angular.module("Accounting").controller("StockbrokerCtrl",["$scope","$modal","Stockbroker",function($scope,$modal,Stockbroker){var vm=this;$scope.Stockbrokers=[],$scope.Search={type:0,code:"",name:""},$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){vm.Services.searchPagination($scope.Search)}},vm.ModalStockbroker={create:function(){$modal.open({templateUrl:"modals/Stockbroker/create/createStockbroker.html",controller:"CreateStockbrokerCtrl"}).result.then(function(result){swal("¡Bolsista creado!","","success")})},detail:function(stockbroker){$modal.open({templateUrl:"modals/Stockbroker/detail/detailStockbroker.html",controller:"DetailStockbrokerCtrl",resolve:{Data:function(){return stockbroker}}}).result.then(function(result){})},edit:function(stockbroker){$modal.open({templateUrl:"modals/Stockbroker/edit/editStockbroker.html",controller:"EditStockbrokerCtrl",resolve:{Data:function(){return stockbroker}}}).result.then(function(result){result&&(stockbroker.descDependenciaLabora=result.descDependencia,stockbroker.codDependenciaLabora=result.codDependencia,swal("¡Bolsista actualizado!","","success"))})}},vm.Events={deleteStockbroker:function(stockbroker,index){swal({title:"Eliminar Bolsista",text:stockbroker.codMatricula+" - "+stockbroker.nombreComp,type:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#DD6B55",confirmButtonText:"Aceptar",closeOnConfirm:!1},function(){vm.Services.deleteStockbroker(stockbroker.codMatricula,index)})}},vm.Services={loader:!1,page:1,search:function(form){var self=this;if(0==self.loader){self.loader=!0;var filter=null;0==form.type?filter=form.code:1==form.type&&(filter=form.name),Stockbroker.search(filter,form.type,this.page).then(function(response){$scope.Stockbrokers=response.data.bolsistas,$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}},searchPagination:function(form){var self=this;if(0==self.loader){self.loader=!0;var filter=null;0==form.type?filter=form.code:1==form.type&&(filter=form.name),Stockbroker.search(filter,form.type,$scope.Pagination.current).then(function(response){$scope.Stockbrokers=response.data.bolsistas,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}},deleteStockbroker:function(id,index){Stockbroker["delete"](id).then(function(response){$scope.Stockbrokers.splice(index,1),swal("¡Eliminado!","Operacion realizada con exito.","success")},function(err){swal("¡Error!",err.data.mensaje,"error")})}}}]),angular.module("Accounting").controller("StructureCtrl",["$scope",function($scope){}]),angular.module("Accounting").controller("PanelCtrl",["$scope","$modal","Session",function($scope,$modal,Session){var vm=this;$scope.profileId=null,vm.Events={toggleMenu:function(event){var block=$(event.currentTarget).parent().find(".subItems");block.stop().slideToggle(200)},subToggleMenu:function(event){var block=$(event.currentTarget).parent().find(".secondSubItems");block.stop().slideToggle(200)},showCalendar:function(){$modal.open({templateUrl:"modals/Calendar/Calendar.html",controller:"CalendarCtrl",windowClass:"app-modal-calendar"}).result.then(function(result){$scope.UtilsGlobal.setDate(result)})}},$scope.Services={constructor:function(){this.getData()},getData:function(){$scope.profileId=Session.get().idProfile}},$scope.Services.constructor()}]),angular.module("Accounting").controller("CreateStockbrokerCtrl",["$scope","$modal","$modalInstance","Stockbroker",function($scope,$modal,$modalInstance,Stockbroker){$scope.Form={student:{},dependence:{}},$scope.Valid={student:!1,dependence:!1},$scope.ModalStudent={show:function(){$modal.open({templateUrl:"modals/Student/list/listStudent.html",controller:"ListStudentCtrl"}).result.then(function(result){$scope.Form.student=result})}},$scope.ModalDependence={show:function(){$modal.open({templateUrl:"modals/Dependence/list/listDependence.html",controller:"ListDependenceCtrl"}).result.then(function(result){$scope.Form.dependence=result})}},$scope.Services={loader:!1,create:function(form){var self=this;if(form.student.codAlumno&&form.dependence.idDependencia&&0==self.loader){self.loader=!0,$scope.Valid={student:!1,dependence:!1};var data={codMatricula:form.student.codAlumno,dniAlumno:form.student.dni,nombreComp:form.student.nombreCompleto,apellidoPat:form.student.apePaterno,apellidoMat:form.student.apeMaterno,nombre:form.student.nomAlumno,idDependenciaPertenece:form.student.idDependenciaPertence,idDependenciaLabora:form.dependence.idDependencia};Stockbroker.create(data).then(function(res){self.loader=!1,$modalInstance.close()},function(err){self.loader=!1,swal("¡Error!",err.data.mensaje,"error")})}else $scope.Valid.student=void 0==form.student.codAlumno,$scope.Valid.dependence=void 0==form.dependence.idDependencia}}}]),angular.module("Accounting").controller("ListStudentCtrl",["$scope","Student","$modalInstance","$mdToast",function($scope,Student,$modalInstance,$mdToast){$scope.Search={filter:""},$scope.Valid={code:!1},$scope.Students=[],$scope.currentStudent=null,$scope.Pagination={total:null,current:null,maxSize:5,changePage:function(){$scope.Services.searchPagination($scope.Search)}},$scope.Events={selectStudent:function(event,student){$(".modStudent .tableContent tbody tr").css("background-color","white"),$(event.currentTarget).css("background-color","rgb(230,230,230)"),$scope.currentStudent=student},accept:function(){void 0==$scope.currentStudent?$scope.Valid.code=!0:($scope.Valid.code=!1,$modalInstance.close($scope.currentStudent))}},$scope.Services={page:1,loader:!1,search:function(form){var self=this;0==self.loader&&(self.loader=!0,Student.search(form.filter,this.page).then(function(response){$scope.Students=response.data.alumnos,$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},searchPagination:function(form){var self=this;0==self.loader&&(self.loader=!0,Student.search(form.filter,$scope.Pagination.current).then(function(response){$scope.Students=response.data.alumnos,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))}}}]),angular.module("Accounting").controller("ListDependenceCtrl",["$scope","Dependence","$modalInstance","Session",function($scope,Dependence,$modalInstance,Session){$scope.Valid={dependence:!1},$scope.DependenceParent={codDependencia:Session.get().codDependence,descDependencia:Session.get().descDependence,idDependencia:Session.get().idDependence},$scope.firstSub=[],$scope.SecondSub=[],$scope.previewDependence=null,$scope.currentDependence=null,$scope.Events={toggleSlide:function(event,nro,dependence){var block=$(event.currentTarget).parent().parent();1==nro?block.find(".firstSub").stop().slideToggle(200):block.find(".secondSub").stop().slideToggle(200),$scope.Services.getSubDependencies(dependence,nro,block)},selectDependence:function(dependence,event){$(".tbtCheck").removeClass("active"),$(event.currentTarget).addClass("active"),$scope.currentDependence=dependence,$scope.previewDependence=dependence.codDependencia+" - "+dependence.descDependencia},accept:function(){$scope.currentDependence?($modalInstance.close($scope.currentDependence),$scope.Valid.dependence=!1):$scope.Valid.dependence=!0}},$scope.Services={loader:!1,init:function(){this.getDependencies()},getDependencies:function(){var self=this;self.loader=!0,Dependence.list(Session.get().idProfile,Session.get().idDependence).then(function(response){$scope.Dependencies=response.data,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})},getSubDependencies:function(dependence,nro,block){Dependence.list(Session.get().idProfile,dependence.idDependencia).then(function(response){1==nro?dependence.sub=response.data:dependence.sub=response.data,$(".cl1").css("display","none"),$(".cl2").css("display","none")},function(err){swal("¡Error!",err.data.mensaje,"error")}),1==nro?block.find(".cl1").css("display","block"):block.find(".cl2").css("display","block")}},$scope.Services.init()}]),angular.module("Accounting").controller("DetailStockbrokerCtrl",["$scope","Data",function($scope,Data){$scope.Services={init:function(){this.getData()},getData:function(){$scope.Stockbroker=Data}},$scope.Services.init()}]),angular.module("Accounting").controller("ProviderCtrl",["$scope","$modal","$state","Provider",function($scope,$modal,$state,Provider){var vm=this;$scope.Providers=[],$scope.Search={type:0,ruc:"",businessName:""},$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){vm.Services.searchPagination($scope.Search)}},vm.ModalProvider={create:function(){$modal.open({templateUrl:"modals/Provider/create/createProvider.html",controller:"CreateProviderCtrl"}).result.then(function(result){})}},vm.Events={goDetailProvider:function(provider){"P"==provider.tipoProveedor?$state.go("app.private.init.detailProvider",{ruc:provider.ruc}):$state.go("app.private.init.detailExternal",{ruc:provider.ruc})}},vm.Services={loader:!1,page:1,init:function(){},search:function(form){var self=this;if(0==self.loader){self.loader=!0;var filter=null;filter=0==form.type?form.ruc:form.businessName,Provider.search(filter,form.type,this.page).then(function(response){$scope.Providers=response.data.proveedores,$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}},searchPagination:function(form){var self=this;if(0==self.loader){self.loader=!0;var filter=null;filter=0==form.type?form.ruc:form.businessName,Provider.search(filter,form.type,$scope.Pagination.current).then(function(response){$scope.Providers=response.data.proveedores,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}}}}]),angular.module("Accounting").controller("CreateproviderCtrl",["$scope","$state","Provider","Sunat",function($scope,$state,Provider,Sunat){var vm=this;$scope.Form={estado:"P",tipoPersona:"P"},$scope.Valid={ruc:!1,direccion:!1,razonSocial:!1,estado:!1,nacionProveedor:!1,tipoPersona:!1},$scope.Events={goProviders:function(){$state.go("app.private.init.provider")},requestRuc:function(ruc){""!=ruc&&void 0!=ruc&&Sunat.ruc({ruc:ruc}).then(function(response){$scope.Form.direccion=response.data.direccion,$scope.Form.razonSocial=response.data.razonSocial,$scope.Form.ruc=response.data.ruc})}},vm.Services={loader:!1,create:function(data){var self=this;$scope.Validate.update(data)&&0==self.loader&&(self.loader=!0,Provider.create(data).then(function(response){swal("¡Proveedor creado!","","success"),self.loader=!1,$state.go("app.private.init.provider")},function(err){self.loader=!1,swal("¡Error!",err.data.mensaje,"error")}))}},$scope.Validate={update:function(data){return $scope.Valid.ruc=""==data.ruc||void 0==data.ruc,$scope.Valid.direccion=""==data.direccion||void 0==data.direccion,$scope.Valid.razonSocial=""==data.razonSocial||void 0==data.razonSocial,$scope.Valid.estado=""==data.estado||void 0==data.estado,$scope.Valid.nacionProveedor=""==data.nacionProveedor||void 0==data.nacionProveedor,$scope.Valid.tipoPersona=""==data.tipoPersona||void 0==data.tipoPersona,!($scope.Valid.ruc||$scope.Valid.direccion||$scope.Valid.razonSocial||$scope.Valid.estado||$scope.Valid.nacionProveedor||$scope.Valid.tipoPersona)}}}]),angular.module("Accounting").controller("DetailproviderCtrl",["$scope","Provider","$stateParams","$state",function($scope,Provider,$stateParams,$state){$scope.ProviderData={},$scope.originData={},$scope.Valid={ruc:!1,direccion:!1,razonSocial:!1,estado:!1,nacionProveedor:!1},$scope.Events={goProviders:function(){$state.go("app.private.init.provider")},cancelEdit:function(){$scope.ProviderData=angular.copy($scope.originData)}},$scope.Services={loader:!1,constructor:function(){this.getData()},getData:function(){Provider.detail($stateParams.ruc).then(function(res){switch(res.data.nacionProveedor){case 1:res.data.nacionProveedor="1";break;case 2:res.data.nacionProveedor="2"}$scope.originData=res.data,$scope.ProviderData=angular.copy(res.data)},function(err){swal("¡Error!",err.data.mensaje,"error")})},update:function(data){var self=this;$scope.Validate.update(data)&&0==self.loader&&(self.loader=!0,Provider.update(data).then(function(res){$scope.originData=angular.copy(data),self.loader=!1,swal("¡Proveedor actualizado!","","success")},function(err){self.loader=!1,swal("¡Error!",err.data.mensaje,"error")}))}},$scope.Services.constructor(),$scope.Validate={update:function(data){return $scope.Valid.ruc=""==data.ruc||void 0==data.ruc,$scope.Valid.direccion=""==data.direccion||void 0==data.direccion,$scope.Valid.razonSocial=""==data.razonSocial||void 0==data.razonSocial,$scope.Valid.estado=""==data.estado||void 0==data.estado,$scope.Valid.nacionProveedor=""==data.nacionProveedor||void 0==data.nacionProveedor,!($scope.Valid.ruc||$scope.Valid.direccion||$scope.Valid.razonSocial||$scope.Valid.estado||$scope.Valid.nacionProveedor)}}}]),angular.module("Accounting").controller("CreateProviderCtrl",["$scope","$state","$modalInstance",function($scope,$state,$modalInstance){$scope.Events={goCreateProvider:function(){$state.go("app.private.init.createProvider"),$modalInstance.close()},goCreateExternal:function(){$state.go("app.private.init.createExternal"),$modalInstance.close()}}}]),angular.module("Accounting").controller("CreateexternalCtrl",["$scope","$state","Provider","Session","Sunat",function($scope,$state,Provider,Session,Sunat){var vm=this;$scope.idProfile=Session.get().idProfile,$scope.Form={estado:"P",tipoPersona:"S"},$scope.Valid={ruc:!1,direccion:!1,estado:!1,nacionProveedor:!1,tipoPersona:!1,nombre:!1,apePaterno:!1,apeMaterno:!1},$scope.Events={goProviders:function(){$state.go("app.private.init.provider")},requestRuc:function(ruc){""!=ruc&&void 0!=ruc&&Sunat.ruc({ruc:ruc}).then(function(response){$scope.Form.direccion=response.data.direccion,$scope.Form.nombre=response.data.nombres,$scope.Form.apePaterno=response.data.apePaterno,$scope.Form.apeMaterno=response.data.apeMaterno,$scope.Form.ruc=response.data.ruc})}},vm.Services={loader:!1,create:function(data){var self=this;$scope.Validate.update(data)&&0==self.loader&&(self.loader=!0,Provider.create(data).then(function(response){swal("¡Servidor a tercero creado!","","success"),self.loader=!1,$state.go("app.private.init.provider")},function(err){self.loader=!1,swal("¡Error!",err.data.mensaje,"error")}))}},$scope.Validate={update:function(data){return $scope.Valid.ruc=""==data.ruc||void 0==data.ruc,$scope.Valid.direccion=""==data.direccion||void 0==data.direccion,$scope.Valid.estado=""==data.estado||void 0==data.estado,$scope.Valid.nacionProveedor=""==data.nacionProveedor||void 0==data.nacionProveedor,$scope.Valid.tipoPersona=""==data.tipoPersona||void 0==data.tipoPersona,$scope.Valid.nombre=""==data.nombre||void 0==data.nombre,$scope.Valid.apePaterno=""==data.apePaterno||void 0==data.apePaterno,$scope.Valid.apeMaterno=""==data.apeMaterno||void 0==data.apeMaterno,!($scope.Valid.ruc||$scope.Valid.direccion||$scope.Valid.estado||$scope.Valid.nacionProveedor||$scope.Valid.tipoPersona||$scope.Valid.nombre||$scope.Valid.apePaterno||$scope.Valid.apeMaterno)}}}]),angular.module("Accounting").controller("DetailexternalCtrl",["$scope","$state","Provider","$stateParams",function($scope,$state,Provider,$stateParams){$scope.ProviderData={},$scope.originData={},$scope.Valid={ruc:!1,direccion:!1,razonSocial:!1,estado:!1,nacionProveedor:!1,nombre:!1,apePaterno:!1,apeMaterno:!1},$scope.Events={goProviders:function(){$state.go("app.private.init.provider")},cancelEdit:function(){$scope.ProviderData=angular.copy($scope.originData)}},$scope.Services={loader:!1,constructor:function(){this.getData()},getData:function(){Provider.detail($stateParams.ruc).then(function(res){switch(res.data.nacionProveedor){case 1:res.data.nacionProveedor="1";break;case 2:res.data.nacionProveedor="2"}$scope.originData=res.data,$scope.ProviderData=angular.copy(res.data)},function(err){swal("¡Error!",err.data.mensaje,"error")})},update:function(data){var self=this;$scope.Validate.update(data)&&0==self.loader&&(self.loader=!0,Provider.update(data).then(function(res){$scope.originData=angular.copy(data),self.loader=!1,swal("¡Servidor a tercero actualizado!","","success")},function(err){self.loader=!1,swal("¡Error!",err.data.mensaje,"error")}))}},$scope.Services.constructor(),$scope.Validate={update:function(data){return $scope.Valid.ruc=""==data.ruc||void 0==data.ruc,$scope.Valid.direccion=""==data.direccion||void 0==data.direccion,$scope.Valid.razonSocial=""==data.razonSocial||void 0==data.razonSocial,$scope.Valid.estado=""==data.estado||void 0==data.estado,$scope.Valid.nacionProveedor=""==data.nacionProveedor||void 0==data.nacionProveedor,$scope.Valid.nombre=""==data.nombre||void 0==data.nombre,$scope.Valid.apePaterno=""==data.apePaterno||void 0==data.apePaterno,$scope.Valid.apeMaterno=""==data.apeMaterno||void 0==data.apeMaterno,!($scope.Valid.ruc||$scope.Valid.direccion||$scope.Valid.razonSocial||$scope.Valid.estado||$scope.Valid.nacionProveedor||$scope.Valid.nombre||$scope.Valid.apePaterno||$scope.Valid.apeMaterno)}}}]),angular.module("Accounting").controller("OpeningcashCtrl",["$scope","$state","Cash","Session",function($scope,$state,Cash,Session){$scope.ProfileId=Session.get().idProfile,$scope.SignupOpenings=[],$scope.SignupOpened=[],$scope.Search={},$scope.SearchOpened={};var currentDate={};$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchSignupOpening($scope.Search)}},$scope.PaginationOpened={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchSignupOpened($scope.SearchOpened)}},$scope.Events={goDetail:function(id){$state.go("app.private.init.openingCashDetail",{id:id})},goCashCreate:function(id){$state.go("app.private.init.openingCashCreate",{id:id})},clearSearchOpening:function(){$scope.Search={},$scope.Services.getSignupOpening($scope.Search)},clearSearchOpened:function(){$scope.SearchOpened={},$scope.Services.getSignupOpened($scope.SearchOpened)}},$scope.Services={page:1,pageOpened:1,loader:!1,loaderOpened:!1,constructor:function(){this.getSignupOpening($scope.Search),this.getSignupOpened($scope.SearchOpened)},getSignupOpening:function(form){var self=this,filter=null;if(self.loader=!0,form.type)switch(form.type){case"0":filter=form.register;break;case"1":filter=form.dependence;break;case"2":filter=form.glossary}Cash.listSignupOpening(currentDate.month.id,currentDate.year,this.page,form.type,filter).then(function(response){response.data.cajasChicas.length>0&&response.data.cajasChicas.forEach(function(obj){obj.fecha=moment(obj.fecha).format("DD/MM/YYYY - h:mm:ss a")}),$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,$scope.SignupOpenings=response.data.cajasChicas,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})},searchSignupOpening:function(form){var self=this,filter=null;if(self.loader=!0,form.type)switch(form.type){case"0":filter=form.register;break;case"1":filter=form.dependence;break;case"2":filter=form.glossary}Cash.listSignupOpening(currentDate.month.id,currentDate.year,$scope.Pagination.current,form.type,filter).then(function(response){response.data.cajasChicas.length>0&&response.data.cajasChicas.forEach(function(obj){obj.fecha=moment(obj.fecha).format("DD/MM/YYYY - h:mm:ss a")}),$scope.SignupOpenings=response.data.cajasChicas,
self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})},getSignupOpened:function(form){var self=this,filter=null;if(self.loaderOpened=!0,form.type)switch(form.type){case"0":filter=form.code;break;case"1":filter=form.dependence;break;case"2":filter=form.attendant;break;case"3":filter=form.register}Cash.listSignupOpened(currentDate.year,this.pageOpened,form.type,filter).then(function(response){$scope.PaginationOpened.total=10*parseInt(response.data.paginaciones),$scope.PaginationOpened.current=1,$scope.SignupOpened=response.data.cajasChicas,self.loaderOpened=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})},searchSignupOpened:function(form){var self=this,filter=null;if(self.loaderOpened=!0,form.type)switch(form.type){case"0":filter=form.code;break;case"1":filter=form.dependence;break;case"2":filter=form.attendant;break;case"3":filter=form.register}Cash.listSignupOpened(currentDate.year,$scope.PaginationOpened.current,form.type,filter).then(function(response){$scope.SignupOpened=response.data.cajasChicas,self.loaderOpened=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}},$scope.$watch("DateGlobal",function(nw,old){currentDate=nw,$scope.Services.constructor()})}]),angular.module("Accounting").controller("SettlementcashCtrl",["$scope","$modal","$state","Refund",function($scope,$modal,$state,Refund){var vm=this;$scope.Refunds={},$scope.idCajaChica="261";var currentDate={};$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchPagination()}},$state.go("app.private.init.refund.init"),vm.ModalRefund={show:function(){$modal.open({templateUrl:"modals/Refund/create/createRefund.html",controller:"CreateRefundCtrl",resolve:{Data:function(){return{idCajachica:$scope.idCajaChica}}}}).result.then(function(result){$scope.Services.getData(),swal("¡Reembolso creado!","","success")})},settlement:function(){$modal.open({templateUrl:"modals/Refund/settlement/createSettlement.html",controller:"CreateSettlementCtrl",resolve:{Data:function(){return{idCajachica:$scope.idCajaChica}}}}).result.then(function(result){$scope.Services.getData(),swal("¡Caja chica liquidada!","","success")})}},vm.Events={selectRefund:function(event,idRefund){$state.go("app.private.init.refund.structure.expenses",{refund:idRefund}),$(event.currentTarget).parent().parent().parent().find("tr").removeClass("blockImportant"),$(".pr--Refund__buttons").slideUp(200,function(){$(event.currentTarget).parent().parent().parent().addClass("blockImportant").parent().find("tr").slideUp(200),$(".rCaption").slideUp(200),$(".Pagination").slideUp(200)}),setTimeout(function(){$(".Refund__variable").slideDown(200)},800)},closeRefund:function(){$state.go("app.private.init.refund.init"),$(".Refund__variable").slideUp(200),setTimeout(function(){$(".pr--Refund__buttons").slideDown(200,function(){$(".Refund--table tbody tr").removeClass("blockImportant").slideDown(200),$(".rCaption").slideDown(200),$(".Pagination").slideDown(200)})},400)},goAccountingSpending:function(event,idRefund){$state.go("app.private.init.refund.structure.accountingSpending",{refund:idRefund}),$(event.currentTarget).parent().parent().parent().find("tr").removeClass("blockImportant"),$(".pr--Refund__buttons").slideUp(200,function(){$(event.currentTarget).parent().parent().parent().addClass("blockImportant").parent().find("tr").slideUp(200),$(".rCaption").slideUp(200),$(".Pagination").slideUp(200)}),setTimeout(function(){$(".Refund__variable").slideDown(200)},800)}},$scope.Services={loader:!1,page:1,constructor:function(){this.getData()},getData:function(){var self=this;self.loader=!0,Refund.getByTime($scope.idCajaChica,currentDate.month.id,currentDate.year,this.page).then(function(res){res.data.reembolsos.length>0&&res.data.reembolsos.forEach(function(obj){obj.fechaCreacion=moment(obj.fechaCreacion).format("DD/MM/YYYY - h:mm:ss a")}),$scope.Pagination.total=10*parseInt(res.data.paginaciones),$scope.Pagination.current=1,$scope.Refunds=res.data.reembolsos,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})},searchPagination:function(){var self=this;0==self.loader&&(self.loader=!0,Refund.getByTime($scope.idCajaChica,currentDate.month.id,currentDate.year,$scope.Pagination.current).then(function(res){res.data.reembolsos.length>0&&res.data.reembolsos.forEach(function(obj){obj.fechaCreacion=moment(obj.fechaCreacion).format("DD/MM/YYYY - h:mm:ss a")}),$scope.Refunds=res.data.reembolsos,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},updateState:function(refund){Refund.updateState(refund.idReembolso,2,refund.tipoReembolso).then(function(response){console.log(response,"cerrar")},function(err){swal("¡Error!",err.data.mensaje,"error")})}},$scope.$watch("DateGlobal",function(nw,old){currentDate=nw,$scope.Services.constructor()})}]),angular.module("Accounting").factory("Provider",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){return{search:function(filter,option,page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/proveedor/buscar",data={filtro:filter,opcion:option,paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},create:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/proveedor/crear";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},detail:function(ruc){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/proveedor/detalle/"+ruc;return Request.Get(url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},update:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/proveedor/actualizar";return Request.Put(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").controller("RefundCtrl",["$scope","$modal","$state","Refund","$rootScope","Session","Cash",function($scope,$modal,$state,Refund,$rootScope,Session,Cash){var vm=this;$scope.Refunds={},$scope.idCajaChica=null,$scope.cajaChicaDetail=null,$scope.currentRefund=null;var currentDate={};$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchPagination()}},$state.go("app.private.init.refund.init"),vm.ModalRefund={show:function(){$modal.open({templateUrl:"modals/Refund/create/createRefund.html",controller:"CreateRefundCtrl",resolve:{Data:function(){return{idCajachica:$scope.idCajaChica}}}}).result.then(function(result){$scope.Services.getData(),swal("¡Reembolso creado!","","success")})},settlement:function(){$modal.open({templateUrl:"modals/Refund/settlement/createSettlement.html",controller:"CreateSettlementCtrl",resolve:{Data:function(){return{idCajachica:$scope.idCajaChica}}}}).result.then(function(result){$scope.Services.getData(),swal("¡Caja chica liquidada!","","success")})}},vm.Events={selectRefund:function(event,refund){$scope.currentRefund=refund,$state.go("app.private.init.refund.structure.expenses",{refund:refund.idReembolso}),$(event.currentTarget).parent().parent().parent().find("tr").removeClass("blockImportant"),$(".pr--Refund__buttons").slideUp(200,function(){$(event.currentTarget).parent().parent().parent().addClass("blockImportant").parent().find("tr").slideUp(200),$(".rCaption").slideUp(200),$(".Pagination").slideUp(200)}),setTimeout(function(){$(".Refund__variable").slideDown(200)},800)},closeRefund:function(){$state.go("app.private.init.refund.init"),$(".Refund__variable").slideUp(200),setTimeout(function(){$(".pr--Refund__buttons").slideDown(200,function(){$(".Refund--table tbody tr").removeClass("blockImportant").slideDown(200),$(".rCaption").slideDown(200),$(".Pagination").slideDown(200)})},400)},goAccountingSpending:function(event,refund){$scope.currentRefund=refund,$state.go("app.private.init.refund.structure.accountingSpending",{refund:refund.idReembolso}),$(event.currentTarget).parent().parent().parent().find("tr").removeClass("blockImportant"),$(".pr--Refund__buttons").slideUp(200,function(){$(event.currentTarget).parent().parent().parent().addClass("blockImportant").parent().find("tr").slideUp(200),$(".rCaption").slideUp(200),$(".Pagination").slideUp(200)}),setTimeout(function(){$(".Refund__variable").slideDown(200)},800)},summaryByItem:function(refund){var data={param_cch:$scope.idCajaChica,param_ree:refund.idReembolso.toString(),param_usuario:Session.get().email,param_reeMes:currentDate.month.id.toString()},url=$rootScope.Path+"public/reporte/resumenxPartidaPDF?param_cch="+data.param_cch+"&param_ree="+data.param_ree+"&param_usuario="+data.param_usuario+"&param_reeMes="+data.param_reeMes;window.open(url,"_blank")},detailedListing:function(refund){var data={param_cch:$scope.idCajaChica,param_ree:refund.idReembolso.toString(),param_user:Session.get().email,param_reeMes:currentDate.month.id.toString()},url=$rootScope.Path+"public/reporte/listadoDetalladoPDF?param_cch="+data.param_cch+"&param_ree="+data.param_ree+"&param_user="+data.param_user+"&param_reeMes="+data.param_reeMes;window.open(url,"_blank")}},$scope.Services={loader:!1,page:1,constructor:function(){this.getByUser()},getData:function(){var self=this;self.loader=!0,Refund.getByTime("C0"+$scope.idCajaChica,currentDate.month.id,currentDate.year,this.page).then(function(res){res.data.reembolsos.length>0&&res.data.reembolsos.forEach(function(obj){obj.fechaCreacion=moment(obj.fechaCreacion).format("DD/MM/YYYY - h:mm:ss a")}),$scope.Pagination.total=10*parseInt(res.data.paginaciones),$scope.Pagination.current=1,res.data.reembolsos.forEach(function(refund){refund.montoReembolso=refund.montoReembolso.toFixed(2)}),$scope.Refunds=res.data.reembolsos,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})},getCashDetail:function(){Refund.getDetail(parseFloat($scope.idCajaChica),currentDate.month.id,currentDate.year).then(function(response){$scope.cajaChicaDetail=response.data},function(err){swal("¡Error!",err.data.mensaje,"error")})},getByUser:function(){var self=this,data={idDependencia:Session.get().idDependence,dni:Session.get().dniUser,anio:(new Date).getFullYear()};Cash.getByUser(data).then(function(response){$scope.idCajaChica=response.data.idCajaChica,self.getCashDetail(),self.getData()},function(err){swal("¡Error!",err.data.mensaje,"error")})},searchPagination:function(){var self=this;0==self.loader&&(self.loader=!0,Refund.getByTime($scope.idCajaChica,currentDate.month.id,currentDate.year,$scope.Pagination.current).then(function(res){res.data.reembolsos.length>0&&res.data.reembolsos.forEach(function(obj){obj.fechaCreacion=moment(obj.fechaCreacion).format("DD/MM/YYYY - h:mm:ss a")}),$scope.Refunds=res.data.reembolsos,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},updateState:function(refund){Refund.updateState(refund.idReembolso,2,refund.tipoReembolso).then(function(response){swal("¡La liquidación fue cerrada!","","success"),refund.codEstadoReembolso="P"},function(err){swal("¡Error!",err.data.mensaje,"error")})}},$scope.$watch("DateGlobal",function(nw,old){currentDate=nw,$scope.Services.constructor()})}]),angular.module("Accounting").controller("CreateRefundCtrl",["$scope","$modalInstance","Data","Refund",function($scope,$modalInstance,Data,Refund){$scope.Form={},$scope.Services={constructor:function(){this.getData(),this.getRefundNumber()},getData:function(){$scope.Form.idCajachica=Data.idCajachica},getRefundNumber:function(){var date=new Date,data={idCajaChica:parseInt($scope.Form.idCajachica),tipoReembolso:"R",anio:date.getFullYear()};Refund.getRefundNumber(data).then(function(res){$scope.Form.numReembolso=res.data.numReembolso},function(err){swal("¡Error!",err.data.mensaje,"error")})},create:function(form){var date=new Date,data={tipoReembolso:"R",idCajaChica:parseInt(form.idCajachica),mes:date.getMonth()+1,anio:date.getFullYear(),numReembolso:form.numReembolso};Refund.create(data).then(function(res){$modalInstance.close(data)},function(err){swal("¡Error!",err.data.mensaje,"error")})}},$scope.Services.constructor()}]),angular.module("Accounting").controller("ExpensesCtrl",["$scope","$state","Refund","$stateParams","Spending",function($scope,$state,Refund,$stateParams,Spending){var vm=this;$scope.ExpensesData=[],$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchPagination()}},vm.Events={goDetail:function(spending){$scope.EventSpending.selectSpending(spending),$state.go("app.private.init.refund.structure.detailSpending",{spending:spending.idDocContable})},deleteSpending:function(spending,index){swal({title:"Eliminar Gasto",type:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#DD6B55",confirmButtonText:"Aceptar",closeOnConfirm:!1},function(){$scope.Services.deleteSpending(spending,index)})}},$scope.Services={loader:!1,page:1,constructor:function(){this.getData()},getData:function(){var self=this;self.loader=!0,Refund.getExpenseByRefund($stateParams.refund,this.page).then(function(res){res.data.gastos.forEach(function(expense){expense.monto=expense.monto.toFixed(2)}),$scope.ExpensesData=res.data.gastos,$scope.EventSpending.setSpending(res.data.gastos.length),$scope.Pagination.total=10*parseInt(res.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})},searchPagination:function(){var self=this;0==self.loader&&(self.loader=!0,Refund.getExpenseByRefund($stateParams.refund,$scope.Pagination.current).then(function(res){res.data.gastos.forEach(function(expense){expense.monto=expense.monto.toFixed(2)}),$scope.ExpensesData=res.data.gastos,$scope.EventSpending.setSpending(res.data.gastos.length),self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},deleteSpending:function(spending,index){var data={idGasto:spending.idGasto,idReembolso:$stateParams.refund};Spending.remove(data).then(function(response){$scope.ExpensesData.splice(index,1),$scope.currentRefund.montoReembolso=parseFloat($scope.currentRefund.montoReembolso)-parseFloat(spending.monto),swal("¡Eliminado!","Operacion realizada con exito.","success")},function(err){swal("¡Error!",err.data.mensaje,"error")})}},$scope.Services.constructor()}]),angular.module("Accounting").controller("CreatespendingCtrl",["$scope","$modal","Document","Tax","$stateParams","Spending","$state","Session",function($scope,$modal,Document,Tax,$stateParams,Spending,$state,Session){$scope.maxDate=new Date;var vm=this;$scope.Documents=[],$scope.Form={docContable:{},date:new Date};var currentDate={};$scope.Data={docContable:{idProveedor:""},docContDetalle:{},gasto:{},cajaChica:{},reembolso:{},impuesto:{}},$scope.Dependences=[],$scope.idCurrentDependence=null,$scope.Bill=!1,$scope.ReceiptFree=!1,$scope.Ticket=!1,$scope.GroundTicket=!1,$scope.SalesTicket=!1,$scope.Taxes=[],$scope.Sorters=[],$scope.CurrentTaxes=[],vm.modalDocument={show:function(){$modal.open({templateUrl:"modals/Document/type/typeDocument.html",controller:"TypedocumentCtrl",resolve:{Data:function(){return $scope.Documents}}}).result.then(function(result){$scope.Bill=!1,$scope.ReceiptFree=!1,$scope.Ticket=!1,$scope.SalesTicket=!1,$scope.GroundTicket=!1,$scope.Data.docContable.idTipoDocContable=result.idTipoDocContable,$scope.Form.docContable.idTipoDocContable=result.idTipoDocContable,$scope.Form.docContable.descTipoDocContable=result.descTipoDocContable,$scope.Taxes=[],20==result.idTipoDocContable&&($scope.Bill=!0,$scope.Services.getTaxes(result.idTipoDocContable)),21==result.idTipoDocContable&&($scope.Ticket=!0,$scope.Services.getTaxes(result.idTipoDocContable)),22==result.idTipoDocContable&&($scope.ReceiptFree=!0,$scope.Services.getTaxes(result.idTipoDocContable)),51==result.idTipoDocContable&&($scope.SalesTicket=!0,$scope.Services.getTaxes(result.idTipoDocContable)),52==result.idTipoDocContable&&($scope.GroundTicket=!0,$scope.Services.getTaxes(result.idTipoDocContable))})}},vm.ModalDependence={show:function(){$modal.open({templateUrl:"modals/Dependence/list/listDependence.html",controller:"ListDependenceCtrl"}).result.then(function(result){result.sorters=[],result.total=0,$scope.Dependences.push(result)})}},vm.ModalProvider={show:function(){$modal.open({templateUrl:"modals/Provider/list/listProvider.html",controller:"ListProviderCtrl"}).result.then(function(result){$scope.Data.docContable.idProveedor=result.ruc,$scope.Form.docContable.ruc=result.ruc,$scope.Form.docContable.nombre=result.razonSocial})}},vm.ModalSorter={show:function(){$modal.open({templateUrl:"modals/Sorter/list/listSorter.html",controller:"ListSorterCtrl"}).result.then(function(result){$scope.Dependences.forEach(function(obj){obj.idDependencia==$scope.idCurrentDependence&&(result.base=0,result.impTotal=0,result.partial=0,result.total=0,result.taxes=angular.copy($scope.CurrentTaxes),obj.sorters.push(result))})})}},$scope.Events={deleteDependence:function(index){swal({title:"Eliminar dependencia",text:"",type:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#DD6B55",confirmButtonText:"Aceptar",closeOnConfirm:!1},function(){$scope.$apply(function(){$scope.Dependences.splice(index,1)}),swal("¡Eliminado!","Operacion realizada con exito.","success")})},selectDependence:function(event,dependence){$scope.idCurrentDependence=dependence.idDependencia,$scope.Sorters=dependence.sorters,$(".tableDependence tbody tr").css("background-color","white"),$(event.currentTarget).parent().parent().parent().css("background-color","rgb(220,220,220)")},deleteSorter:function(index){swal({title:"Eliminar clasificador",text:"",type:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#DD6B55",confirmButtonText:"Aceptar",closeOnConfirm:!1},function(){$scope.Dependences.forEach(function(obj){obj.idDependencia==$scope.idCurrentDependence&&$scope.$apply(function(){obj.sorters.splice(index,1)})}),swal("¡Eliminado!","Operacion realizada con exito.","success")})},calculateImp:function(value,sorter){sorter.taxes.forEach(function(tax){1==tax.idTipoImpuesto&&(tax.impTotal=parseFloat(value*parseFloat(tax.porcentajeImp)*10).toFixed(2))}),this.calculeTotal(sorter)},otherImp:function(sorter){this.calculeTotal(sorter)},calculeTotal:function(sorter){sorter.partial=angular.copy(sorter.base),sorter.total=angular.copy(sorter.base),sorter.taxes.forEach(function(tax){sorter.partial=parseFloat(sorter.partial)+parseFloat(tax.impTotal),sorter.total=parseFloat(sorter.total)+parseFloat(tax.impTotal)});var sum=0,total=0;$scope.Sorters.forEach(function(sor){sum=parseFloat(sum)+parseFloat(sor.total)}),$scope.Dependences.forEach(function(obj){obj.idDependencia==$scope.idCurrentDependence&&(obj.total=sum),total=parseFloat(total)+parseFloat(obj.total)})},toggleImp:function(tax,list){var idx=list.indexOf(tax);idx>-1?list.splice(idx,1):list.push(tax),$scope.Dependences.forEach(function(dependence){dependence.sorters.forEach(function(sorter){sorter.taxes=angular.copy($scope.CurrentTaxes)})})},existsImp:function(tax,list){return list.indexOf(tax)>-1}},$scope.Services={constructor:function(){this.getDocuments()},getDocuments:function(){Document.list(Session.get().idProfile,1).then(function(res){$scope.Documents=res.data.tiposDoc},function(err){swal("¡Error!",err.data.mensaje,"error")})},getTaxes:function(idDocCont){Tax.list(idDocCont).then(function(res){res.data.forEach(function(tax){tax.impTotal=0}),$scope.Taxes=res.data},function(err){swal("¡Error!",err.data.mensaje,"error")})},saveSpend:function(){var arrayDocContDetail=[],totalNeto=0,totalBruto=0,totalImp=0;$scope.Dependences.forEach(function(dep){dep.sorters.forEach(function(sor){totalNeto=parseFloat(totalNeto)+parseFloat(sor.base),totalBruto=parseFloat(totalBruto)+parseFloat(sor.total);var tempImp=0,taxes=[];sor.taxes.forEach(function(tax){tempImp=parseFloat(tempImp)+parseFloat(tax.impTotal),taxes.push({idImpuesto:tax.idTipoImpuesto,montoImpuesto:tax.impTotal})}),totalImp=parseFloat(totalImp)+parseFloat(tempImp);var obj={idDependencia:dep.idDependencia,anio:parseInt(currentDate.year),impuestos:taxes,idGenerica:sor.codEspecifica,anioGenerica:parseInt(currentDate.year),montoBaseImponible:parseFloat(sor.base),montoTotalImp:tempImp,montoTotalBruto:sor.total};arrayDocContDetail.push(obj)})});var data={docContable:JSON.stringify({idTipoDocContable:$scope.Form.docContable.idTipoDocContable,idProveedor:$scope.Data.docContable.idProveedor,serieDocContable:$scope.Data.docContable.serieDocContable,numDocContable:$scope.Data.docContable.numDocContable,fechaDocContable:moment($scope.Form.fechaDocContable).format("DD/MM/YYYY"),notaDocContable:$scope.Data.docContable.notaDocContable,montoTotalNeto:totalNeto,montoTotalImp:totalImp,montoTotalBruto:totalBruto,glosaDocContable:$scope.Data.docContable.glosaDocContable}),docContDetalle:JSON.stringify(arrayDocContDetail),gasto:JSON.stringify({idReembolso:parseFloat($stateParams.refund),monto:totalBruto})};data.docContable=data.docContable.replace(/"/g,"'"),data.docContDetalle=data.docContDetalle.replace(/"/g,"'"),data.gasto=data.gasto.replace(/"/g,"'"),Spending.create(data).then(function(response){swal("¡Gasto creado!","","success"),$scope.currentRefund.montoReembolso=parseFloat($scope.currentRefund.montoReembolso)+parseFloat(totalBruto),$state.go("app.private.init.refund.structure.expenses")},function(err){swal("¡Error!",err.data.mensaje,"error")})}},$scope.Services.constructor(),$scope.$watch("DateGlobal",function(nw,old){currentDate=nw})}]),angular.module("Accounting").controller("StructurespendingCtrl",["$scope",function($scope){$scope.nroSpending=0,$scope.currentSpending=null,$scope.EventSpending={setSpending:function(nro){$scope.nroSpending=nro},selectSpending:function(spending){$scope.currentSpending=spending}}}]),angular.module("Accounting").controller("TypedocumentCtrl",["$scope","Data","$modalInstance",function($scope,Data,$modalInstance){$scope.Documents=[],$scope.Filter={},$scope.currentDocument={},$scope.Events={select:function(event,item){$(".modTypeDocument .tableContent tbody tr").css("background-color","white"),$(event.currentTarget).css("background-color","rgb(230,230,230)"),$scope.currentDocument=item},accept:function(){$modalInstance.close($scope.currentDocument)}},$scope.Services={constructor:function(){this.getData()},getData:function(){$scope.Documents=Data}},$scope.Services.constructor()}]),angular.module("Accounting").controller("ListSorterCtrl",["$scope","Sorter","$modalInstance",function($scope,Sorter,$modalInstance){$scope.Sorters=[],$scope.currentSorter=null,$scope.inputSorter=null,$scope.Valid={code:!1},$scope.Pagination={total:null,current:null,maxSize:5,changePage:function(){$scope.Services.searchPagination()}},$scope.Events={select:function(event,sorter){$scope.currentSorter=sorter,$scope.inputSorter=sorter.cadclasificador+" - "+sorter.descespecifica,$(".modSorter .tableContent tbody tr").css("background-color","white"),$(event.currentTarget).css("background-color","rgb(230,230,230)")},accept:function(){void 0==$scope.currentSorter?$scope.Valid.code=!0:($scope.Valid.code=!1,$modalInstance.close($scope.currentSorter))}},$scope.Services={page:1,loader:!1,constructor:function(){this.getData()},getData:function(){var self=this;0==self.loader&&(self.loader=!0,Sorter.list(this.page).then(function(response){$scope.Sorters=response.data.clasificador,$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},searchPagination:function(){var self=this;0==self.loader&&(self.loader=!0,Sorter.list($scope.Pagination.current).then(function(response){$scope.Sorters=response.data.clasificador,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))}},$scope.Services.constructor()}]),angular.module("Accounting").controller("DetailspendingCtrl",["$scope","Refund","$stateParams","Document","$modal","Spending","Tax","Session","$state",function($scope,Refund,$stateParams,Document,$modal,Spending,Tax,Session,$state){$scope.selectRefund=$scope.currentRefund,$scope.maxDate=new Date;var vm=this;$scope.Documents=[],$scope.Form={docContable:{},date:new Date};var currentDate={};$scope.Data={docContable:{idProveedor:""},docContDetalle:{},gasto:{},cajaChica:{},reembolso:{},impuesto:{}},$scope.Dependencies=[],$scope.idCurrentDependence=null,$scope.Bill=!1,$scope.ReceiptFree=!1,$scope.Ticket=!1,$scope.GroundTicket=!1,$scope.SalesTicket=!1,$scope.Taxes=[],$scope.Sorters=[],$scope.CurrentTaxes=[],vm.modalDocument={show:function(){$modal.open({templateUrl:"modals/Document/type/typeDocument.html",controller:"TypedocumentCtrl",resolve:{Data:function(){return $scope.Documents}}}).result.then(function(result){$scope.Bill=!1,$scope.ReceiptFree=!1,$scope.Ticket=!1,$scope.SalesTicket=!1,$scope.GroundTicket=!1,$scope.Data.docContable.idTipoDocContable=result.idTipoDocContable,$scope.Form.docContable.idTipoDocContable=result.idTipoDocContable,$scope.Form.docContable.descTipoDocContable=result.descTipoDocContable,$scope.Taxes=[],20==result.idTipoDocContable&&($scope.Bill=!0,$scope.Services.getTaxes(result.idTipoDocContable)),21==result.idTipoDocContable&&($scope.Ticket=!0,$scope.Services.getTaxes(result.idTipoDocContable)),22==result.idTipoDocContable&&($scope.ReceiptFree=!0,$scope.Services.getTaxes(result.idTipoDocContable)),51==result.idTipoDocContable&&($scope.SalesTicket=!0,$scope.Services.getTaxes(result.idTipoDocContable)),52==result.idTipoDocContable&&($scope.GroundTicket=!0,$scope.Services.getTaxes(result.idTipoDocContable))})}},vm.ModalDependence={show:function(){$modal.open({templateUrl:"modals/Dependence/list/listDependence.html",controller:"ListDependenceCtrl"}).result.then(function(result){result.sorters=[],result.total=0,$scope.Dependencies.push(result)})}},vm.ModalProvider={show:function(){$modal.open({templateUrl:"modals/Provider/list/listProvider.html",controller:"ListProviderCtrl"}).result.then(function(result){$scope.Data.docContable.idProveedor=result.ruc,$scope.Form.docContable.ruc=result.ruc,$scope.Form.docContable.nombre=result.razonSocial})}},vm.ModalSorter={show:function(){$modal.open({templateUrl:"modals/Sorter/list/listSorter.html",controller:"ListSorterCtrl"}).result.then(function(result){$scope.Dependencies.forEach(function(obj){obj.idDependencia==$scope.idCurrentDependence&&(result.base=0,result.impTotal=0,result.partial=0,result.total=0,result.taxes=angular.copy($scope.CurrentTaxes),obj.sorters.push(result))})})}},$scope.Events={selectDependence:function(event,dependence){$scope.idCurrentDependence=dependence.idDependencia,$scope.Sorters=dependence.sorters,$(".tableDependence tbody tr").css("background-color","white"),$(event.currentTarget).parent().parent().parent().css("background-color","rgb(220,220,220)")},deleteDependence:function(index){swal({title:"Eliminar dependencia",text:"",type:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#DD6B55",confirmButtonText:"Aceptar",closeOnConfirm:!1},function(){$scope.$apply(function(){$scope.Dependencies.splice(index,1)}),swal("¡Eliminado!","Operacion realizada con exito.","success")})},deleteSorter:function(index){swal({title:"Eliminar clasificador",text:"",type:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#DD6B55",confirmButtonText:"Aceptar",closeOnConfirm:!1},function(){$scope.Dependencies.forEach(function(obj){obj.idDependencia==$scope.idCurrentDependence&&$scope.$apply(function(){obj.sorters.splice(index,1),obj.total=0,obj.sorters.forEach(function(item){obj.total=parseFloat(obj.total)+parseFloat(item.total)})})}),swal("¡Eliminado!","Operacion realizada con exito.","success")})},calculateImp:function(value,sorter){sorter.taxes&&sorter.taxes.forEach(function(tax){1==tax.idTipoImpuesto&&(tax.impTotal=parseFloat(value*parseFloat(tax.porcentajeImp)*10).toFixed(2))}),this.calculeTotal(sorter)},otherImp:function(sorter){this.calculeTotal(sorter)},calculeTotal:function(sorter){sorter.partial=angular.copy(sorter.base),sorter.total=angular.copy(sorter.base),sorter.taxes&&sorter.taxes.forEach(function(tax){sorter.partial=parseFloat(sorter.partial)+parseFloat(tax.impTotal),sorter.total=parseFloat(sorter.total)+parseFloat(tax.impTotal)});var sum=0,total=0;$scope.Sorters.forEach(function(sor){sum=parseFloat(sum)+parseFloat(sor.total)}),$scope.Dependencies.forEach(function(obj){obj.idDependencia==$scope.idCurrentDependence&&(obj.total=sum),total=parseFloat(total)+parseFloat(obj.total)})},toggleImp:function(tax,list){tax.ck=!tax.ck;var flag=!1;list.forEach(function(item,i,a){item.idTipoImpuesto==tax.idTipoImpuesto&&(a.splice(i,1),flag=!0)}),0==flag&&(tax.impTotal=0,list.push(tax)),$scope.Dependencies.forEach(function(dependence){dependence.sorters.forEach(function(sorter){sorter.taxes=angular.copy($scope.CurrentTaxes)})})},existsImp:function(tax,list){return list.indexOf(tax)>-1}},$scope.Services={loader:!1,constructor:function(){this.getData(),this.getDocuments()},getData:function(){var self=this;Refund.getDetailBySpending($stateParams.spending).then(function(res){res.data.impuestos&&res.data.impuestos.forEach(function(tax){var tx={abrevImpuesto:tax.nombImpuesto,codTipoImpuesto:null,desTipoImpuesto:null,idTipoImpuesto:tax.idImpuesto,porcentajeImp:tax.porcentajeImp,tipoImpAplicado:null};$scope.CurrentTaxes.push(tx)}),20==res.data.idTipoDocContable&&($scope.Bill=!0,$scope.Services.getTaxes(res.data.idTipoDocContable)),21==res.data.idTipoDocContable&&($scope.Ticket=!0,$scope.Services.getTaxes(res.data.idTipoDocContable)),22==res.data.idTipoDocContable&&($scope.ReceiptFree=!0,$scope.Services.getTaxes(res.data.idTipoDocContable)),51==res.data.idTipoDocContable&&($scope.SalesTicket=!0,$scope.Services.getTaxes(res.data.idTipoDocContable)),52==res.data.idTipoDocContable&&($scope.GroundTicket=!0,$scope.Services.getTaxes(res.data.idTipoDocContable)),$scope.Data.docContable.idProveedor=res.data.idProveedor,$scope.Form.docContable.idDocContable=res.data.idDocContable,$scope.Data.docContable.idTipoDocContable=res.data.idTipoDocContable,$scope.Form.docContable.idTipoDocContable=res.data.idTipoDocContable,$scope.Form.docContable.descTipoDocContable=res.data.descTipoDoc,$scope.Data.docContable.serieDocContable=res.data.serieDocContable,$scope.Data.docContable.numDocContable=res.data.numDocContable,$scope.Form.fechaDocContable=new Date(res.data.fechaDocContable),$scope.Form.docContable.ruc=res.data.idProveedor,$scope.Form.docContable.nombre=res.data.razonSocialPro,$scope.Form.docContable.glosaDocContable=res.data.glosaDocContable,$scope.Data.docContable.notaDocContable=res.data.notaDocContable,self.getDependencies(res.data.idDocContable)},function(err){swal("¡Error!",err.data.mensaje,"error")})},getDocuments:function(){Document.list(Session.get().idProfile,1).then(function(res){$scope.Documents=res.data.tiposDoc},function(err){swal("¡Error!",err.data.mensaje,"error")})},getTaxes:function(idDocCont){Tax.list(idDocCont).then(function(res){res.data.forEach(function(tax){tax.ck=!1,$scope.CurrentTaxes.forEach(function(cr){cr.idTipoImpuesto==tax.idTipoImpuesto&&(tax.ck=!0)})}),$scope.Taxes=res.data},function(err){swal("¡Error!",err.data.mensaje,"error")})},getDependencies:function(id){Spending.getDependencies(id).then(function(response){
response.data.forEach(function(dependence){dependence.sorters=[],dependence.calsificadores.forEach(function(sorter){var dt={cadclasificador:sorter.cadClasificador,descespecifica:sorter.dscClasificador,base:sorter.montoBaseImponible,impTotal:sorter.montoTotalImp,partial:sorter.montoBaseImponible,total:sorter.montoTotalBruto,taxes:sorter.impuestos,idDocContDetalle:sorter.idDocContDetalle,idGenerica:sorter.idGenerica};$scope.CurrentTaxes=[],dt.taxes.forEach(function(tax){var cim={idTipoImpuesto:tax.idImpuesto,impTotal:0,abrevImpuesto:tax.nombImpuesto,porcentajeImp:tax.porcentajeImp};tax.idTipoImpuesto=tax.idImpuesto,$scope.CurrentTaxes.push(cim),tax.impTotal=tax.montoImpuesto}),dependence.sorters.push(dt)});var data={codDependencia:dependence.codDependencia,descDependencia:dependence.dscDependencia,total:dependence.montoTotalBruto,idDependencia:dependence.idDependencia,montoTotalImp:dependence.montoTotalImp,montoBaseImponible:dependence.montoTotalNeto,montoTotalBruto:dependence.montoTotalBruto,sorters:dependence.sorters};$scope.Dependencies.push(data)})},function(err){swal("¡Error!",err.data.mensaje,"error")})},update:function(){var self=this;if(0==self.loader){self.loader=!0;var arrayDocContDetail=[],totalNeto=0,totalBruto=0,totalImp=0;$scope.Dependencies.forEach(function(dep){dep.sorters.forEach(function(sor){totalNeto=parseFloat(totalNeto)+parseFloat(sor.base),totalBruto=parseFloat(totalBruto)+parseFloat(sor.total);var tempImp=0,taxes=[];sor.taxes&&sor.taxes.forEach(function(tax){tempImp=parseFloat(tempImp)+parseFloat(tax.impTotal);var send={idImpuesto:tax.idTipoImpuesto,montoImpuesto:tax.impTotal};tax.idDocContableImp&&(send.idDocContableImp=tax.idDocContableImp),taxes.push(send)}),totalImp=parseFloat(totalImp)+parseFloat(tempImp);var obj={idDependencia:dep.idDependencia,anio:parseInt(currentDate.year),impuestos:taxes,idGenerica:sor.idGenerica||sor.codEspecifica,anioGenerica:parseInt(currentDate.year),montoBaseImponible:parseFloat(sor.base),montoTotalImp:tempImp,montoTotalBruto:parseFloat(sor.total),idDocContDetalle:sor.idDocContDetalle};arrayDocContDetail.push(obj)})});var data={docContable:JSON.stringify({idDocContable:$scope.Form.docContable.idDocContable,idTipoDocContable:$scope.Form.docContable.idTipoDocContable,idProveedor:$scope.Data.docContable.idProveedor,serieDocContable:$scope.Data.docContable.serieDocContable,numDocContable:$scope.Data.docContable.numDocContable,fechaDocContable:moment($scope.Form.fechaDocContable).format("DD/MM/YYYY"),notaDocContable:$scope.Data.docContable.notaDocContable,montoTotalNeto:totalNeto,montoTotalImp:totalImp,montoTotalBruto:totalBruto,glosaDocContable:$scope.Form.docContable.glosaDocContable}),docContDetalle:JSON.stringify(arrayDocContDetail),gasto:JSON.stringify({idGasto:$scope.currentSpending.idGasto,idReembolso:parseFloat($stateParams.refund),monto:totalBruto})};data.docContable=data.docContable.replace(/"/g,"'"),data.docContDetalle=data.docContDetalle.replace(/"/g,"'"),data.gasto=data.gasto.replace(/"/g,"'"),Spending.update(data).then(function(response){swal("¡Gasto actualizado!","","success"),$state.go("app.private.init.refund.structure.expenses"),self.loader=!1},function(err){self.loader=!1,swal("¡Error!",err.data.mensaje,"error")})}}},$scope.Services.constructor(),$scope.$watch("DateGlobal",function(nw,old){currentDate=nw})}]),angular.module("Accounting").controller("AccountingspendingCtrl",["$scope","$modal","Refund","$stateParams","Session","$state",function($scope,$modal,Refund,$stateParams,Session,$state){var vm=this;$scope.Expenses=[],$scope.Form={};var currentDate={};$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchPagination()}},vm.Modal={project:function(){$modal.open({templateUrl:"modals/Project/list/listProjects.html",controller:"ListProjectsCtrl"}).result.then(function(result){$scope.Form.codProyConvenio=result.codProyConvenio,$scope.Form.descProyConvenio=result.descProyConvenio})},area:function(){$modal.open({templateUrl:"modals/Area/list/listArea.html",controller:"ListAreaCtrl"}).result.then(function(result){$scope.Form.codArea=result.codArea,$scope.Form.descArea=result.descArea})}},$scope.Services={loader:!1,constructor:function(){this.getExpenses(),this.getSummary()},getExpenses:function(){var self=this;0==self.loader&&(self.loader=!0,Refund.getExpensesByRefund({idReembolso:$stateParams.refund}).then(function(response){$scope.Expenses=response.data.gastos,$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},searchPagination:function(){var self=this;0==self.loader&&(self.loader=!0,Refund.getExpensesByRefund({idReembolso:$stateParams.refund,paginacion:$scope.Pagination.current}).then(function(response){$scope.Expenses=response.data.gastos,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},getSummary:function(){if($scope.currentRefund){var data={numReembolso:$scope.currentRefund.numReembolso,montoReembolso:$scope.currentRefund.montoReembolso,idPerfil:Session.get().idProfile,idCajaChica:$scope.idCajaChica,mes:currentDate.month.id,anio:currentDate.year};Refund.summary(data).then(function(response){console.log(response.data,"response.data"),$scope.Form=response.data},function(err){swal("¡Error!",err.data.mensaje,"error")})}},generateAccountingRecord:function(form){if(""!=form.codArea&&void 0!=form.codArea){var data={idReembolso:$stateParams.refund,numReembolso:form.numReembolso,notaRegistro:form.notaRegistro||"",glosa:form.glosa,tipo:$scope.currentRefund.tipoReembolso,idDependencia:Session.get().idDependence,idCajaChica:$scope.idCajaChica,idUsuario:Session.get().dniUser,idRegContable:$scope.currentRefund.idRegContable,idProyConvenio:form.codProyConvenio,codArea:form.codArea};Refund.generateAccountingRecord(data).then(function(response){swal("¡Registro contable generado!","","success"),$state.go("app.private.init.refund.init")},function(err){swal("¡Error!",err.data.mensaje,"error")})}}},$scope.$watch("DateGlobal",function(nw,old){currentDate=nw,$scope.Services.constructor()})}]),angular.module("Accounting").factory("Stockbroker",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){return{search:function(filter,option,page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/bolsista/buscar",data={filtro:filter,opcion:option,paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},"delete":function(id){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/bolsista/eliminar/"+id;return Request.Delete(url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},create:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/bolsista/crear";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},update:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/bolsista/actualizar";return Request.Put(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").factory("Student",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){return{search:function(filter,page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/alumno/buscar",data={filtro:filter,paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").factory("Dependence",["Request","$q","$rootScope","Session",function(Request,$q,$rootScope,Session){return{list:function(idRole,idDependence){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/dependencia/buscar",data={idPerfil:idRole,idDependencia:idDependence};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").controller("EditStockbrokerCtrl",["$scope","Data","$modal","$modalInstance","Stockbroker",function($scope,Data,$modal,$modalInstance,Stockbroker){$scope.Form={},$scope.currentDependence={},$scope.ModalDependence={show:function(){$modal.open({templateUrl:"modals/Dependence/list/listDependence.html",controller:"ListDependenceCtrl"}).result.then(function(result){$scope.currentDependence=result,$scope.Form.codDependencia=result.codDependencia,$scope.Form.descDependencia=result.descDependencia,$scope.Form.idDependencia=result.idDependencia})}},$scope.Services={loader:!1,init:function(){this.getData()},getData:function(){$scope.Form=Data,$scope.Form.codDependencia=Data.codDependenciaLabora,$scope.Form.descDependencia=Data.descDependenciaLabora,$scope.Form.idDependencia=null},update:function(form){var self=this;if(form.idDependencia){var data={idDependenciaLabora:form.idDependencia,codMatricula:form.codMatricula};0==self.loader&&(self.loader=!0,Stockbroker.update(data).then(function(res){$modalInstance.close($scope.currentDependence)},function(err){self.loader=!1,swal("¡Error!",err.data.mensaje,"error")}))}else $modalInstance.close()}},$scope.Services.init()}]),angular.module("Accounting").factory("Refund",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){return{getByTime:function(idCash,month,year,page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/reembolso/listarxCCHxMesxAnio",data={codCajaChica:idCash,mes:month,anio:year,paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getExpenseByRefund:function(idRefund,page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/reembolso/listarGastosxReembolso",data={idReembolso:idRefund,paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getDetailBySpending:function(idSpending){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/docContable/detalle/"+idSpending;return Request.Get(url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getDetail:function(idCash,month,year){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/cajaChica/buscarDetalle",data={idCajaChica:idCash,mes:month,anio:year};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getRefundNumber:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/reembolso/numeroOperacion";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},create:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/reembolso/crear";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},updateState:function(idRefund,state,type){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/reembolso/cambiarEstado",data={idReembolso:idRefund,idEstadoReembolso:state,tipoReembolso:type};return Request.Put(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},listCashTurns:function(year,code,page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/vuelta/listarVueltasxCCH",data={anio:year,codCajaChica:code,paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},updateCashTurns:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/vuelta/actualizar";return Request.Put(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},detailedListing:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/reembolso/listadoDetalladoPDF";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getExpensesByRefund:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/reembolso/listarGastosxEspecifica";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},summary:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/regContable/resumenReembolso";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},generateAccountingRecord:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/regContable/generarRegistroContable";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getRefundsValidate:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/reembolso/listarLiquidadosxMesxAnio";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getExpensesByRefundValidate:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/reembolso/listarGastosxReembolso";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},changeStateRefundValidate:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/reembolso/recibirRechazarReembolso";return Request.Put(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").factory("Cash",["$q","$rootScope","Request","Session",function($q,$rootScope,Request,Session){return{opened:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/cajaChica/aperturar";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},listSignupOpening:function(month,year,page,option,filter){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/cajaChica/listarCCHxApertura",data={mes:month,anio:year,paginacion:page,opcion:option,filtro:filter};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},listSignupOpened:function(year,page,option,filter){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/cajaChica/listarCCHAperturadas",data={anio:year,paginacion:page,opcion:option,filtro:filter};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},signupOpeneningDetail:function(id){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/cajaChica/detalleCCHxApertura/"+id;return Request.Get(url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},signupOpenedDetail:function(id){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/cajaChica/detalleCCHAperturada/"+id;return Request.Get(url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},updateOpened:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/cajaChica/actualizarApertura";return Request.Put(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getUsers:function(page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/usuario/listarUsuariosCCH",data={paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getByUser:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/cajaChica/buscarCajaDeUsuario";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").factory("Document",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){return{list:function(idPerfil,page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/tipoDocumentoContable/listar",data={idPerfil:idPerfil,paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").factory("Sorter",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){return{list:function(page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/clasificador/listar",data={paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").factory("Tax",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){return{list:function(idDocument){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/impuesto/listar",data={idDocCont:idDocument};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").controller("ListProviderCtrl",["$scope","Provider","$modalInstance",function($scope,Provider,$modalInstance){$scope.Providers=[],$scope.currentProvider={},$scope.Search={type:0,ruc:"",businessName:""},$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchPagination($scope.Search)}},$scope.Events={select:function(event,item){$(".modProviderList .tableContent tbody tr").css("background-color","white"),$(event.currentTarget).css("background-color","rgb(230,230,230)"),$scope.currentProvider=item},accept:function(){$modalInstance.close($scope.currentProvider)}},$scope.Services={loader:!1,page:1,init:function(){},search:function(form){var self=this;if(0==self.loader){self.loader=!0;var filter=null;filter=0==form.type?form.ruc:form.businessName,Provider.search(filter,form.type,this.page).then(function(response){$scope.Providers=response.data.proveedores,$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}},searchPagination:function(form){var self=this;if(0==self.loader){self.loader=!0;var filter=null;filter=0==form.type?form.ruc:form.businessName,Provider.search(filter,form.type,$scope.Pagination.current).then(function(response){$scope.Providers=response.data.proveedores,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}}}}]),angular.module("Accounting").controller("CreateSettlementCtrl",["$scope","$modalInstance","Data","Refund",function($scope,$modalInstance,Data,Refund){$scope.Form={},$scope.Services={constructor:function(){this.getData(),this.getRefundNumber()},getData:function(){$scope.Form.idCajachica=Data.idCajachica},getRefundNumber:function(){var date=new Date,data={idCajaChica:parseInt($scope.Form.idCajachica),tipoReembolso:"L",anio:date.getFullYear()};Refund.getRefundNumber(data).then(function(res){$scope.Form.numReembolso=res.data.numReembolso},function(err){swal("¡Error!",err.data.mensaje,"error")})},create:function(form){var date=new Date,data={tipoReembolso:"L",idCajaChica:parseInt(form.idCajachica),mes:date.getMonth()+1,anio:date.getFullYear(),numReembolso:form.numReembolso};Refund.create(data).then(function(res){$modalInstance.close(data)},function(err){swal("¡Error!",err.data.mensaje,"error")})}},$scope.Services.constructor()}]),angular.module("Accounting").controller("ListProjectsCtrl",["$scope","Project","$modalInstance",function($scope,Project,$modalInstance){$scope.Projects=[],$scope.currentProject=null,$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchPagination()}},$scope.Events={selectProject:function(event,project){$(".modTypeDocument .tableContent tbody tr").css("background-color","white"),$(event.currentTarget).css("background-color","rgb(230,230,230)"),$scope.currentProject=project},accept:function(){$modalInstance.close($scope.currentProject)}},$scope.Services={page:1,loader:!1,constructor:function(){this.getData()},getData:function(){var self=this;0==self.loader&&(self.loader=!0,Project.list(this.page).then(function(response){$scope.Projects=response.data.proyectos,$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},searchPagination:function(){var self=this;0==self.loader&&(self.loader=!0,Project.list($scope.Pagination.current).then(function(response){$scope.Projects=response.data.proyectos,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))}},$scope.Services.constructor()}]),angular.module("Accounting").factory("Project",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){return{list:function(page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/proyConvenio/listar",data={paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").factory("Area",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){return{list:function(page){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/area/listar",data={paginacion:page};return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").controller("OpeningcashdetailCtrl",["$scope","$stateParams","Cash","$modal","$state","Session","$rootScope",function($scope,$stateParams,Cash,$modal,$state,Session,$rootScope){var currentDate={};$scope.OriginData={},$scope.idCajaChica=null,$scope.profileId=Session.get().idProfile,$scope.Form={},$scope.Valid={anioApertura:!1,codCajaChica:!1,anioRegistro:!1,idRegContable:!1,codDependencia:!1,descDependencia:!1,nombreResponsable:!1,nombreEncargado:!1,montoMensual:!1,montoMaxDoc:!1,idNumMeta:!1,emailUser:!1,numMontos:!1,dniEncargado:!1,nombreCompleto:!1},$scope.Events={modalDependence:function(){$modal.open({templateUrl:"modals/Dependence/list/listDependence.html",controller:"ListDependenceCtrl"}).result.then(function(result){$scope.Form.idDependencia=result.idDependencia,$scope.Form.codDependencia=result.codDependencia,$scope.Form.descDependencia=result.descDependencia})},modalUsers:function(){$modal.open({templateUrl:"modals/User/list/listUser.html",controller:"ListUserCtrl",windowClass:"app-modal-user"}).result.then(function(result){$scope.Form.nombreCompleto=result.nombreCompleto,$scope.Form.emailUser=result.email,$scope.Form.dniEncargado=result.dniUsuario})},modalRefund:function(){$modal.open({templateUrl:"modals/Refund/list/listRefund.html",controller:"ListRefundCtrl",windowClass:"app-modal-refund",resolve:{CurrentDate:function(){return currentDate},DataCash:function(){return $scope.OriginData},CashId:function(){return $scope.idCajaChica}}}).result.then(function(result){swal("¡Reembolsos por mes actualizados!","","success")})},reportRefund:function(){$modal.open({templateUrl:"modals/Refund/report/reportRefund.html",controller:"ReportRefundCtrl",resolve:{CashId:function(){return $scope.OriginData.idCajaChica},CurrentDate:function(){return currentDate}}}).result.then(function(result){swal("¡Reporte generado!","","success")})}},$scope.Services={data:{},constructor:function(){this.getData(),this.getByUser()},getData:function(){Cash.signupOpenedDetail($stateParams.id).then(function(response){$scope.OriginData=response.data,$scope.Form=angular.copy(response.data),$scope.Form.idNumMeta=response.data.numMeta,$scope.Form.emailUser=response.data.email},function(err){swal("¡Error!",err.data.mensaje,"error")})},getByUser:function(){var data={idDependencia:Session.get().idDependence,dni:Session.get().dniUser,anio:(new Date).getFullYear()};Cash.getByUser(data).then(function(response){$scope.idCajaChica=response.data.idCajaChica},function(err){swal("¡Error!",err.data.mensaje,"error")})},update:function(form){if($scope.Validate.update(form)){var data={anioApertura:form.anioApertura,codCajaChica:form.codCajaChica,idDependencia:form.idDependencia,numMontos:form.numMontos,montoMensual:form.montoMensual,montoMaxDoc:form.montoMaxDoc,nombreResponsable:form.nombreResponsable.toUpperCase(),nombreEncargado:form.nombreEncargado,estadoCajaChica:form.estadoCajaChica,dniEncargado:form.dniEncargado,idNumMeta:form.idNumMeta,idRegContable:form.idRegContable,idCajaChica:$scope.OriginData.idCajaChica};Cash.updateOpened(data).then(function(response){swal("¡Caja chica actualizada!","","success")},function(err){swal("¡Error!",err.data.mensaje,"error")})}}},$scope.Services.constructor(),$scope.Validate={update:function(data){return $scope.Valid.anioApertura=void 0==data.anioApertura||""==data.anioApertura,$scope.Valid.codCajaChica=void 0==data.codCajaChica||""==data.codCajaChica,$scope.Valid.anioRegistro=void 0==data.anioRegistro||""==data.anioRegistro,$scope.Valid.idRegContable=void 0==data.idRegContable||""==data.idRegContable,$scope.Valid.codDependencia=void 0==data.codDependencia||""==data.codDependencia,$scope.Valid.descDependencia=void 0==data.descDependencia||""==data.descDependencia,$scope.Valid.nombreResponsable=void 0==data.nombreResponsable||""==data.nombreResponsable,$scope.Valid.nombreEncargado=void 0==data.nombreEncargado||""==data.nombreEncargado,$scope.Valid.montoMensual=void 0==data.montoMensual||""==data.montoMensual,$scope.Valid.idNumMeta=void 0==data.idNumMeta||""==data.idNumMeta,$scope.Valid.emailUser=void 0==data.emailUser||""==data.emailUser,$scope.Valid.dniEncargado=void 0==data.dniEncargado||""==data.dniEncargado,$scope.Valid.nombreCompleto=void 0==data.nombreCompleto||""==data.nombreCompleto,!($scope.Valid.anioApertura||$scope.Valid.codCajaChica||$scope.Valid.anioRegistro||$scope.Valid.idRegContable||$scope.Valid.codDependencia||$scope.Valid.descDependencia||$scope.Valid.nombreResponsable||$scope.Valid.nombreEncargado||$scope.Valid.montoMensual||$scope.Valid.montoMaxDoc||$scope.Valid.idNumMeta||$scope.Valid.emailUser||$scope.Valid.numMontos||$scope.Valid.dniEncargado||$scope.Valid.nombreCompleto)}},$scope.$watch("DateGlobal",function(nw,old){currentDate=nw,$scope.Services.constructor()})}]),angular.module("Accounting").controller("OpeningcashcreateCtrl",["$scope","Cash","$stateParams","$modal","$state",function($scope,Cash,$stateParams,$modal,$state){$scope.Form={},$scope.Valid={anioApertura:!1,codCajaChica:!1,anioRegistro:!1,idRegContable:!1,codDependencia:!1,descDependencia:!1,nombreResponsable:!1,nombreEncargado:!1,montoMensual:!1,montoMaxDoc:!1,idNumMeta:!1,emailUser:!1,numMontos:!1,dniEncargado:!1,nombreCompleto:!1},$scope.Events={modalDependence:function(){$modal.open({templateUrl:"modals/Dependence/list/listDependence.html",controller:"ListDependenceCtrl"}).result.then(function(result){$scope.Form.idDependencia=result.idDependencia,$scope.Form.codDependencia=result.codDependencia,$scope.Form.descDependencia=result.descDependencia})},modalUsers:function(){$modal.open({templateUrl:"modals/User/list/listUser.html",controller:"ListUserCtrl",windowClass:"app-modal-user"}).result.then(function(result){$scope.Form.nombreCompleto=result.nombreCompleto,$scope.Form.emailUser=result.email,$scope.Form.dniEncargado=result.dniUsuario})}},$scope.Services={data:{},constructor:function(){this.getData()},getData:function(){var self=this;Cash.signupOpeneningDetail($stateParams.id).then(function(response){
$scope.Form=angular.copy(response.data),$scope.Form.montoMaxDoc="0.00",$scope.Form.numMontos="0",$scope.Form.estadoCajaChica="1",self.data=response.data},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})},opened:function(form){if($scope.Validate.opened(form)){var data={anioApertura:form.anioApertura,codCajaChica:form.codCajaChica,idDependencia:form.idDependencia,numMontos:form.numMontos,montoMensual:form.montoMensual,montoMaxDoc:form.montoMaxDoc,nombreResponsable:form.nombreResponsable.toUpperCase(),nombreEncargado:form.nombreEncargado,estadoCajaChica:form.estadoCajaChica,dniEncargado:form.dniEncargado,idNumMeta:form.idNumMeta,idRegContable:form.idRegContable};Cash.opened(data).then(function(response){swal("¡Caja chica aperturada!","","success"),$state.go("app.private.init.openingCash")},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}}},$scope.Services.constructor(),$scope.Validate={opened:function(data){return $scope.Valid.anioApertura=void 0==data.anioApertura||""==data.anioApertura,$scope.Valid.codCajaChica=void 0==data.codCajaChica||""==data.codCajaChica,$scope.Valid.anioRegistro=void 0==data.anioRegistro||""==data.anioRegistro,$scope.Valid.idRegContable=void 0==data.idRegContable||""==data.idRegContable,$scope.Valid.codDependencia=void 0==data.codDependencia||""==data.codDependencia,$scope.Valid.descDependencia=void 0==data.descDependencia||""==data.descDependencia,$scope.Valid.nombreResponsable=void 0==data.nombreResponsable||""==data.nombreResponsable,$scope.Valid.nombreEncargado=void 0==data.nombreEncargado||""==data.nombreEncargado,$scope.Valid.montoMensual=void 0==data.montoMensual||""==data.montoMensual,$scope.Valid.montoMaxDoc=void 0==data.montoMaxDoc||""==data.montoMaxDoc,$scope.Valid.idNumMeta=void 0==data.idNumMeta||""==data.idNumMeta,$scope.Valid.emailUser=void 0==data.emailUser||""==data.emailUser,$scope.Valid.numMontos=void 0==data.numMontos||""==data.numMontos,$scope.Valid.dniEncargado=void 0==data.dniEncargado||""==data.dniEncargado,$scope.Valid.nombreCompleto=void 0==data.nombreCompleto||""==data.nombreCompleto,!($scope.Valid.anioApertura||$scope.Valid.codCajaChica||$scope.Valid.anioRegistro||$scope.Valid.idRegContable||$scope.Valid.codDependencia||$scope.Valid.descDependencia||$scope.Valid.nombreResponsable||$scope.Valid.nombreEncargado||$scope.Valid.montoMensual||$scope.Valid.montoMaxDoc||$scope.Valid.idNumMeta||$scope.Valid.emailUser||$scope.Valid.numMontos||$scope.Valid.dniEncargado||$scope.Valid.nombreCompleto)}}}]),angular.module("Accounting").controller("ListUserCtrl",["$scope","Cash","$modalInstance",function($scope,Cash,$modalInstance){$scope.Valid={code:!1},$scope.Users=[],$scope.currentUser=null,$scope.Pagination={total:null,current:null,maxSize:5,changePage:function(){$scope.Services.searchPagination()}},$scope.Events={selectStudent:function(event,user){$(".modStudent .tableContent tbody tr").css("background-color","white"),$(event.currentTarget).css("background-color","rgb(230,230,230)"),$scope.currentUser=user},accept:function(){void 0==$scope.currentUser?$scope.Valid.code=!0:($scope.Valid.code=!1,$modalInstance.close($scope.currentUser))}},$scope.Services={page:1,loader:!1,constructor:function(){this.getData()},getData:function(){var self=this;0==self.loader&&(self.loader=!0,Cash.getUsers(this.page).then(function(response){$scope.Users=response.data.usuarios,$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},searchPagination:function(){var self=this;0==self.loader&&(self.loader=!0,Cash.getUsers($scope.Pagination.current).then(function(response){$scope.Users=response.data.usuarios,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))}},$scope.Services.constructor()}]),angular.module("Accounting").factory("DateService",["$localStorage",function($localStorage){var months=[{name:"Enero",id:1},{name:"Febrero",id:2},{name:"Marzo",id:3},{name:"Abril",id:4},{name:"Mayo",id:5},{name:"Junio",id:6},{name:"Julio",id:7},{name:"Agosto",id:8},{name:"Septiembre",id:9},{name:"Octubre",id:10},{name:"Noviembre",id:11},{name:"Diciembre",id:12}];return{getYears:function(){for(var date=new Date,years=[],i=date.getFullYear();i>=2014;i--)years.push(i);return years},getMonths:function(){return months},getMonth:function(nro){var current={};return months.forEach(function(obj){obj.id==nro&&(current=obj)}),current},saveDateStorage:function(form){$localStorage.currentDate=JSON.stringify(form)},getDateStorage:function(){return $localStorage.currentDate?JSON.parse($localStorage.currentDate):void 0}}}]),angular.module("Accounting").controller("CalendarCtrl",["$scope","DateService","$modalInstance",function($scope,DateService,$modalInstance){var date=new Date;$scope.Years=[],$scope.Months=[],$scope.Form={},$scope.Events={selectDate:function(form){DateService.saveDateStorage(form),$modalInstance.close(form)}},$scope.Services={constructor:function(){this.getDate()},getDate:function(){$scope.Years=DateService.getYears(),$scope.Months=DateService.getMonths(),DateService.getDateStorage()?($scope.Years.forEach(function(item,iterator,array){DateService.getDateStorage().year==item&&($scope.Form.year=array[iterator])}),$scope.Form.month=$scope.Months[DateService.getDateStorage().month-1].id):$scope.Form={year:$scope.Years[0],month:$scope.Months[date.getMonth()].id}}},$scope.Services.constructor()}]),angular.module("Accounting").controller("ListRefundCtrl",["$scope","Refund","CurrentDate","DataCash","$modalInstance","$modal","CashId",function($scope,Refund,CurrentDate,DataCash,$modalInstance,$modal,CashId){$scope.Refunds={},$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchRefund()}},$scope.Events={deleteRefund:function(refund){swal({title:"Eliminar vuelta",type:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#DD6B55",confirmButtonText:"Aceptar",closeOnConfirm:!1},function(){})},createFlying:function(){$modal.open({templateUrl:"modals/Flying/create/createFlying.html",controller:"CreateFlyingCtrl",resolve:{CashId:function(){return CashId}}}).result.then(function(result){})}},$scope.Services={page:1,loader:!1,constructor:function(){this.getData()},getData:function(){var self=this;self.loader=!0,Refund.listCashTurns(CurrentDate.year,DataCash.codCajaChica,this.page).then(function(response){$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,$scope.Refunds=response.data.vueltas,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})},searchRefund:function(){var self=this;0==self.loader&&(self.loader=!0,Refund.listCashTurns(CurrentDate.year,DataCash.codCajaChica,$scope.Pagination.current).then(function(response){$scope.Refunds=response.data.vueltas,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},updateRefunds:function(){var data={vueltas:JSON.stringify($scope.Refunds)};Refund.updateCashTurns(data).then(function(response){$modalInstance.close($scope.currentUser)},function(err){swal("¡Error!",err.data.mensaje,"error")})}},$scope.Services.constructor()}]),angular.module("Accounting").factory("Spending",["$q","Request","$rootScope","Session",function($q,Request,$rootScope,Session){return{create:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/gasto/grabar";return Request.Post(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},remove:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/gasto/eliminar";return Request.Put(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getSorter:function(){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/docContDetalle/detalle/mostrarClasificadores";return Request.Get(url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},getDependencies:function(idDocContable){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/docContable/detalleDependencia/"+idDocContable;return Request.Get(url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise},update:function(data){var headers={token:Session.get().token,usuario:Session.get().email,aplicacion:Session.get().application,ip:Session.get().ip},deferred=$q.defer(),url=$rootScope.Path+"private/gasto/actualizar";return Request.Put(data,url,headers).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]),angular.module("Accounting").controller("HomeCtrl",["$scope",function($scope){}]),angular.module("Accounting").factory("Session",["$localStorage","$rootScope",function($localStorage,$rootScope){return{set:function(data){$localStorage.token=data.token,$localStorage.emailUser=data.email,$localStorage.application=data.app,$localStorage.ip=data.ip,$localStorage.idProfile=data.idProfile,$localStorage.idDependence=data.idDependence,$localStorage.dniUser=data.dniUser,$localStorage.codDependence=data.codDependence,$localStorage.descDependence=data.descDependence},get:function(){return{token:$localStorage.token,email:$localStorage.emailUser,application:$localStorage.application,ip:$localStorage.ip,idProfile:$localStorage.idProfile,idDependence:$localStorage.idDependence,dniUser:$localStorage.dniUser,codDependence:$localStorage.codDependence,descDependence:$localStorage.descDependence}},status:function(){return $localStorage.token},restartTime:function(){$rootScope.$emit("restartCountdown",{})}}}]),angular.module("Accounting").controller("ListAreaCtrl",["$scope","Area","$modalInstance",function($scope,Area,$modalInstance){$scope.Areas=[],$scope.currentArea=null,$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchPagination()}},$scope.Events={selectProject:function(event,area){$(".modTypeDocument .tableContent tbody tr").css("background-color","white"),$(event.currentTarget).css("background-color","rgb(230,230,230)"),$scope.currentArea=area},accept:function(){$modalInstance.close($scope.currentArea)}},$scope.Services={page:1,loader:!1,constructor:function(){this.getData()},getData:function(){var self=this;0==self.loader&&(self.loader=!0,Area.list(this.page).then(function(response){console.log(response,"area"),$scope.Areas=response.data.areas,$scope.Pagination.total=10*parseInt(response.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))},searchPagination:function(){var self=this;0==self.loader&&(self.loader=!0,Area.list($scope.Pagination.current).then(function(response){$scope.Areas=response.data.areas,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1}))}},$scope.Services.constructor()}]),angular.module("Accounting").controller("RefundvalidateCtrl",["$scope","$modal","$state","Refund","$rootScope","Session","Cash",function($scope,$modal,$state,Refund,$rootScope,Session,Cash){var vm=this;$scope.ProfileId=Session.get().idProfile,$scope.Refunds={},$scope.idCajaChica="261",$scope.cajaChicaDetail=null,$scope.currentRefund=null,$scope.Search={};var currentDate={};$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchPagination()}},$state.go("app.private.init.refundValidate.init"),vm.Events={clearSearchOpening:function(){$scope.Search={},$scope.Services.getData()},selectRefund:function(event,idRefund){$state.go("app.private.init.refundValidate.structure.expenses",{refund:idRefund}),$(event.currentTarget).parent().parent().parent().find("tr").removeClass("blockImportant"),$(event.currentTarget).parent().parent().parent().addClass("blockImportant").parent().find("tr").slideUp(200),$(".rCaption").slideUp(200),$(".Pagination").slideUp(200),setTimeout(function(){$(".Refund__variable").slideDown(200)},400)},closeRefund:function(){$state.go("app.private.init.refundValidate.init"),$(".Refund__variable").slideUp(200,function(){$(".Refund--table tbody tr").removeClass("blockImportant").slideDown(200),$(".rCaption").slideDown(200),$(".Pagination").slideDown(200)})},summaryByItem:function(refund){var data={param_cch:$scope.idCajaChica,param_ree:refund.idReembolso.toString(),param_usuario:Session.get().email,param_reeMes:currentDate.month.id.toString()},url=$rootScope.Path+"public/reporte/resumenxPartidaPDF?param_cch="+data.param_cch+"&param_ree="+data.param_ree+"&param_usuario="+data.param_usuario+"&param_reeMes="+data.param_reeMes;window.open(url,"_blank")},detailedListing:function(refund){var data={param_cch:$scope.idCajaChica,param_ree:refund.idReembolso.toString(),param_user:Session.get().email,param_reeMes:currentDate.month.id.toString()},url=$rootScope.Path+"public/reporte/listadoDetalladoPDF?param_cch="+data.param_cch+"&param_ree="+data.param_ree+"&param_user="+data.param_user+"&param_reeMes="+data.param_reeMes;window.open(url,"_blank")}},$scope.Services={loader:!1,page:1,constructor:function(){this.getData(),this.getCashDetail(),this.getByUser()},getData:function(){var self=this;if(0==self.loader){self.loader=!0;var filter=null;if($scope.Search.type)switch($scope.Search.type){case"0":filter=$scope.Search.dependence;break;case"1":filter=$scope.Search.attendant;break;case"2":filter=$scope.Search.responsable;break;case"3":filter=$scope.Search.register}var data={anio:currentDate.year,mes:currentDate.month.id,idPerfil:Session.get().idProfile,paginacion:this.page,opcion:$scope.Search.type,filtro:filter};Refund.getRefundsValidate(data).then(function(res){res.data.reembolsos.forEach(function(refund){refund.fechaApertura=moment(refund.fechaApertura).format("DD/MM/YYYY")}),$scope.Pagination.total=10*parseInt(res.data.paginaciones),$scope.Pagination.current=1,$scope.Refunds=res.data.reembolsos,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}},searchPagination:function(){var self=this;if(0==self.loader){self.loader=!0;var filter=null;if($scope.Search.type)switch($scope.Search.type){case"0":filter=$scope.Search.dependence;break;case"1":filter=$scope.Search.attendant;break;case"2":filter=$scope.Search.responsable;break;case"3":filter=$scope.Search.register}var data={anio:currentDate.year,mes:currentDate.month.id,idPerfil:Session.get().idProfile,paginacion:$scope.Pagination.current,opcion:$scope.Search.type,filtro:filter};Refund.getRefundsValidate(data).then(function(res){res.data.reembolsos.forEach(function(refund){refund.fechaApertura=moment(refund.fechaApertura).format("DD/MM/YYYY")}),$scope.Refunds=res.data.reembolsos,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}},getByUser:function(){var self=this,data={idDependencia:Session.get().idDependence,dni:Session.get().dniUser,anio:(new Date).getFullYear()};Cash.getByUser(data).then(function(response){$scope.idCajaChica=response.data.idCajaChica,self.getCashDetail()},function(err){swal("¡Error!",err.data.mensaje,"error")})},getCashDetail:function(){Refund.getDetail(parseFloat($scope.idCajaChica),currentDate.month.id,currentDate.year).then(function(response){$scope.cajaChicaDetail=response.data},function(err){swal("¡Error!",err.data.mensaje,"error")})},changeState:function(refund,state,index,list){var data={idReembolso:refund.idReembolso,idEstadoReembolso:state};Refund.changeStateRefundValidate(data).then(function(response){console.log(response,"response"),3==state&&(refund.estado="CP"),5==state&&list.splice(index,1)})}},$scope.$watch("DateGlobal",function(nw,old){currentDate=nw,$scope.Services.constructor()})}]),angular.module("Accounting").controller("StructurespendingvalidateCtrl",["$scope",function($scope){$scope.nroSpending=0,$scope.EventSpending={setSpending:function(nro){$scope.nroSpending=nro}}}]),angular.module("Accounting").controller("ExpensesvalidateCtrl",["$scope","$state","Refund","$stateParams","Spending",function($scope,$state,Refund,$stateParams,Spending){var vm=this;$scope.ExpensesData=[],$scope.Pagination={total:null,current:null,maxSize:10,changePage:function(){$scope.Services.searchPagination()}},vm.Events={goDetail:function(spending){$state.go("app.private.init.refundValidate.structure.detailSpending",{spending:spending})}},$scope.Services={loader:!1,page:1,constructor:function(){this.getData()},getData:function(){var self=this;if(0==self.loader){self.loader=!0;var data={idReembolso:$stateParams.refund,paginacion:this.page};Refund.getExpensesByRefundValidate(data).then(function(res){$scope.ExpensesData=res.data.gastos,$scope.Pagination.total=10*parseInt(res.data.paginaciones),$scope.Pagination.current=1,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}},searchPagination:function(){var self=this;if(0==self.loader){self.loader=!0;var data={idReembolso:$stateParams.refund,paginacion:$scope.Pagination.current};Refund.getExpensesByRefundValidate(data).then(function(res){$scope.ExpensesData=res.data.gastos,self.loader=!1},function(err){swal("¡Error!",err.data.mensaje,"error"),self.loader=!1})}}},$scope.Services.constructor()}]),angular.module("Accounting").controller("DetailspendingvalidateCtrl",["$scope","Refund","$stateParams","Document","$modal","Spending","Tax","Session","$state",function($scope,Refund,$stateParams,Document,$modal,Spending,Tax,Session,$state){$scope.maxDate=new Date;var vm=this;$scope.Documents=[],$scope.Form={docContable:{},date:new Date};var currentDate={};$scope.Data={docContable:{idProveedor:""},docContDetalle:{},gasto:{},cajaChica:{},reembolso:{},impuesto:{}},$scope.Dependencies=[],$scope.idCurrentDependence=null,$scope.Bill=!1,$scope.ReceiptFree=!1,$scope.Ticket=!1,$scope.GroundTicket=!1,$scope.SalesTicket=!1,$scope.Taxes=[],$scope.Sorters=[],$scope.CurrentImp=null,vm.modalDocument={show:function(){$modal.open({templateUrl:"modals/Document/type/typeDocument.html",controller:"TypedocumentCtrl",resolve:{Data:function(){return $scope.Documents}}}).result.then(function(result){$scope.Bill=!1,$scope.ReceiptFree=!1,$scope.Ticket=!1,$scope.SalesTicket=!1,$scope.GroundTicket=!1,$scope.Data.docContable.idTipoDocContable=result.idTipoDocContable,$scope.Form.docContable.idTipoDocContable=result.idTipoDocContable,$scope.Form.docContable.descTipoDocContable=result.descTipoDocContable,$scope.Taxes=[],20==result.idTipoDocContable&&($scope.Bill=!0,$scope.Services.getTaxes(result.idTipoDocContable)),21==result.idTipoDocContable&&($scope.Ticket=!0,$scope.Services.getTaxes(result.idTipoDocContable)),22==result.idTipoDocContable&&($scope.ReceiptFree=!0,$scope.Services.getTaxes(result.idTipoDocContable)),51==result.idTipoDocContable&&($scope.SalesTicket=!0,$scope.Services.getTaxes(result.idTipoDocContable)),52==result.idTipoDocContable&&($scope.GroundTicket=!0,$scope.Services.getTaxes(result.idTipoDocContable))})}},vm.ModalDependence={show:function(){$modal.open({templateUrl:"modals/Dependence/list/listDependence.html",controller:"ListDependenceCtrl"}).result.then(function(result){result.sorters=[],result.total=0,$scope.Dependencies.push(result)})}},vm.ModalProvider={show:function(){$modal.open({templateUrl:"modals/Provider/list/listProvider.html",controller:"ListProviderCtrl"}).result.then(function(result){$scope.Data.docContable.idProveedor=result.ruc,$scope.Form.docContable.ruc=result.ruc,$scope.Form.docContable.nombre=result.razonSocial})}},vm.ModalSorter={show:function(){$modal.open({templateUrl:"modals/Sorter/list/listSorter.html",controller:"ListSorterCtrl"}).result.then(function(result){$scope.Dependencies.forEach(function(obj){obj.idDependencia==$scope.idCurrentDependence&&(result.base=0,result.impTotal=0,result.partial=0,result.total=0,obj.sorters.push(result))})})}},$scope.Events={selectDependence:function(event,dependence){$scope.idCurrentDependence=dependence.idDependencia,$scope.Sorters=dependence.sorters,$(".tableDependence tbody tr").css("background-color","white"),$(event.currentTarget).parent().parent().parent().css("background-color","rgb(220,220,220)")},deleteDependence:function(index){swal({title:"Eliminar dependencia",text:"",type:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#DD6B55",confirmButtonText:"Aceptar",closeOnConfirm:!1},function(){$scope.$apply(function(){$scope.Dependencies.splice(index,1)}),swal("¡Eliminado!","Operacion realizada con exito.","success")})},deleteSorter:function(index){swal({title:"Eliminar clasificador",text:"",type:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonColor:"#DD6B55",confirmButtonText:"Aceptar",closeOnConfirm:!1},function(){$scope.Dependencies.forEach(function(obj){obj.idDependencia==$scope.idCurrentDependence&&$scope.$apply(function(){obj.calsificadores.splice(index,1)})}),swal("¡Eliminado!","Operacion realizada con exito.","success")})},selectImp:function(id){$scope.Taxes.forEach(function(obj){obj.idTipoImpuesto==id&&($scope.CurrentImp=obj)})},calculateImp:function(value,sorter){$scope.CurrentImp&&(sorter.impTotal=parseFloat(value*parseFloat($scope.CurrentImp.porcentajeImp)*10)),""==sorter.impTotal||void 0==sorter.impTotal||0==sorter.impTotal?(sorter.partial=parseFloat(value),sorter.total=parseFloat(value)):(sorter.partial=parseFloat(sorter.impTotal)+parseFloat(value),sorter.total=parseFloat(sorter.impTotal)+parseFloat(value));var sum=0,total=0;$scope.Sorters.forEach(function(sor){sum=parseFloat(sum)+parseFloat(sor.total)}),$scope.Dependencies.forEach(function(obj){obj.idDependencia==$scope.idCurrentDependence&&(obj.total=sum),total=parseFloat(total)+parseFloat(obj.total)})},otherImp:function(value,sorter){""==value||void 0==value||0==value?(sorter.partial=parseFloat(sorter.base),sorter.total=parseFloat(sorter.base)):(sorter.partial=parseFloat(value)+parseFloat(sorter.base),sorter.total=parseFloat(value)+parseFloat(sorter.base));var sum=0,total=0;$scope.Sorters.forEach(function(sor){sum=parseFloat(sum)+parseFloat(sor.total)}),$scope.Dependencies.forEach(function(obj){obj.idDependencia==$scope.idCurrentDependence&&(obj.total=sum),total=parseFloat(total)+parseFloat(obj.total)})}},$scope.Services={loader:!1,constructor:function(){this.getData(),this.getDocuments()},getData:function(){var self=this;Refund.getDetailBySpending($stateParams.spending).then(function(res){$scope.Data.docContable.idTipoDocContable=res.data.idTipoDocContable,$scope.Form.docContable.idTipoDocContable=res.data.idTipoDocContable,$scope.Form.docContable.descTipoDocContable=res.data.descTipoDoc,$scope.Data.docContable.serieDocContable=res.data.serieDocContable,$scope.Data.docContable.numDocContable=res.data.numDocContable,$scope.Form.fechaDocContable=new Date(res.data.fechaDocContable),$scope.Form.docContable.ruc=res.data.idProveedor,$scope.Form.docContable.nombre=res.data.razonSocialPro,$scope.Data.docContable.notaDocContable=res.data.notaDocContable,self.getDependencies(res.data.idDocContable)},function(err){swal("¡Error!",err.data.mensaje,"error")})},getDocuments:function(){Document.list(Session.get().idProfile,1).then(function(res){$scope.Documents=res.data.tiposDoc},function(err){swal("¡Error!",err.data.mensaje,"error")})},getTaxes:function(idDocCont){Tax.list(idDocCont).then(function(res){$scope.Taxes=res.data},function(err){swal("¡Error!",err.data.mensaje,"error")})},getDependencies:function(id){Spending.getDependencies(id).then(function(response){response.data.forEach(function(dependence){dependence.sorters=[],dependence.calsificadores.forEach(function(sorter){sorter.idImpuesto&&($scope.CurrentImp={abrevImpuesto:sorter.nombImpuesto,porcentajeImp:sorter.porcentajeImp,idImpuesto:sorter.idImpuesto});var dt={cadclasificador:sorter.cadClasificador,descespecifica:sorter.dscClasificador,base:sorter.montoBaseImponible,impTotal:sorter.montoTotalImp,partial:sorter.montoBaseImponible,total:sorter.montoTotalBruto};dependence.sorters.push(dt)});var data={codDependencia:dependence.codDependencia,descDependencia:dependence.dscDependencia,total:dependence.montoTotalBruto,idDependencia:dependence.idDependencia,montoTotalImp:dependence.montoTotalImp,montoBaseImponible:dependence.montoTotalNeto,montoTotalBruto:dependence.montoTotalBruto,sorters:dependence.sorters};$scope.Dependencies.push(data)})},function(err){swal("¡Error!",err.data.mensaje,"error")})},update:function(){var self=this;if(0==self.loader){self.loader=!0;var arrayDocContDetail=[],totalNeto=0,totalBruto=0,totalImp=0;$scope.Dependencies.forEach(function(dep){dep.sorters.forEach(function(sor){totalImp=parseFloat(totalImp)+parseFloat(sor.impTotal),totalNeto=parseFloat(totalNeto)+parseFloat(sor.base),totalBruto=parseFloat(totalBruto)+parseFloat(sor.total);var obj={idDependencia:dep.idDependencia,anio:parseInt(currentDate.year),idImpuesto:0,idGenerica:sor.codEspecifica,anioGenerica:parseInt(currentDate.year),montoBaseImponible:parseFloat(sor.base),montoTotalImp:sor.impTotal,montoTotalBruto:sor.total};$scope.CurrentImp&&(obj.idImpuesto=$scope.CurrentImp.idTipoImpuesto),arrayDocContDetail.push(obj)})});var data={docContable:JSON.stringify({idTipoDocContable:$scope.Form.docContable.idTipoDocContable,idProveedor:$scope.Data.docContable.idProveedor,serieDocContable:$scope.Data.docContable.serieDocContable,numDocContable:$scope.Data.docContable.numDocContable,fechaDocContable:moment($scope.Form.fechaDocContable).format("DD/MM/YYYY"),notaDocContable:$scope.Data.docContable.notaDocContable,montoTotalNeto:totalNeto,montoTotalImp:totalImp,montoTotalBruto:totalBruto}),docContDetalle:JSON.stringify(arrayDocContDetail),gasto:JSON.stringify({idReembolso:parseFloat($stateParams.refund),numGasto:$scope.nroSpending,monto:totalBruto})};data.docContable=data.docContable.replace(/"/g,"'"),data.docContDetalle=data.docContDetalle.replace(/"/g,"'"),data.gasto=data.gasto.replace(/"/g,"'"),Spending.update(data).then(function(response){swal("¡Gasto actualizado!","","success"),$state.go("app.private.init.refund.structure.expenses"),self.loader=!1},function(err){self.loader=!1,swal("¡Error!",err.data.mensaje,"error")})}}},$scope.Services.constructor(),$scope.$watch("DateGlobal",function(nw,old){currentDate=nw})}]),angular.module("Accounting").controller("ReportRefundCtrl",["$scope","CashId","Session","CurrentDate","$rootScope","$modalInstance",function($scope,CashId,Session,CurrentDate,$rootScope,$modalInstance){$scope.Form={},$scope.Services={report:function(form){var data={param_cch:CashId,param_user:Session.get().email,param_mes1:moment(form.starDate).format("DD-MM-YYYY"),param_mes2:moment(form.endDate).format("DD-MM-YYYY"),param_dep:Session.get().idDependence,param_anio:CurrentDate.year},url=$rootScope.Path+"public/reporte/listadoReembolsosPDF?param_cch="+data.param_cch+"&param_user="+data.param_user+"&param_mes1="+data.param_mes1+"&param_mes2="+data.param_mes2+"&param_dep="+data.param_dep+"&param_anio="+data.param_anio;window.open(url,"_blank"),$modalInstance.close()}}}]),angular.module("Accounting").controller("CreateFlyingCtrl",["$scope","DateService","Session","CashId","Document","$modal",function($scope,DateService,Session,CashId,Document,$modal){$scope.Months=DateService.getMonths(),$scope.Documents=[],$scope.Events={modalDocument:function(){$modal.open({templateUrl:"modals/Document/type/typeDocument.html",controller:"TypedocumentCtrl",resolve:{Data:function(){return $scope.Documents}}}).result.then(function(result){console.log(result,"document"),$scope.Form.tipoDocumento=result.tipoDocumento})}},$scope.Services={constructor:function(){this.getDocuments()},create:function(form){({mes:form.month,tipoVuelta:"V",idCajaChica:CashId,idDependencia:Session.get().idDependence,tipoDocumento:form.tipoDocumento,numDocumento:form.numDocumento,montoVuelta:form.montoVuelta,estadoVuelta:"1",dniUsuCreador:Session.get().dniUser})},getDocuments:function(){Document.list(Session.get().idProfile,1).then(function(res){$scope.Documents=res.data.tiposDoc},function(err){swal("¡Error!",err.data.mensaje,"error")})}},$scope.Services.constructor()}]),angular.module("Accounting").factory("Sunat",["$q","$rootScope","Request",function($q,$rootScope,Request){return{ruc:function(data){var deferred=$q.defer(),url=$rootScope.PathSunat+"public/sunat/consultaRuc";return Request.Post({},url,data).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}),deferred.promise}}}]);